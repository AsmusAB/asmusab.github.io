<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<link href="coqdoc.css" rel="stylesheet" type="text/css" />
<title>Token_Manager</title>
</head>

<body>

<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library Token_Manager</h1>

<div class="code">
</div>

<div class="doc">
<a name="lab98"></a><h1 class="section">Token Manager</h1>
 This is an implementation of the following file.

<div class="paragraph"> </div>

https://github.com/bender-labs/wrap-tz-contracts/blob/master/ligo/fa2/multi_asset/token_manager.mligo.

<div class="paragraph"> </div>

Endpoints used for minting and burning of tokens

<div class="paragraph"> </div>


</div>
<div class="code">
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">FA2Interface_Wrap</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">FA2_Multi_Token</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">FA2Types</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">List</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">Blockchain</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">Monads</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">Containers</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">ZArith</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">RecordUpdate</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">Fees_Lib</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">ContractCommon</span>.<br/>
<span class="id" title="keyword">Import</span> <span class="id" title="var">ListNotations</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab99"></a><h1 class="section">Implementation</h1>

</div>
<div class="code">
<span class="id" title="keyword">Section</span> <span class="id" title="var">Token_Manager</span>.<br/>

<br/>
<span class="id" title="keyword">Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">N_scope</span>.<br/>

<br/>
<span class="id" title="keyword">Context</span> {<span class="id" title="var">BaseTypes</span> : <span class="id" title="var">ChainBase</span>}.<br/>

<br/>
</div>

<div class="doc">
<a name="lab100"></a><h2 class="section">Mint update balances</h2>

</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <span class="id" title="var">mint_update_balances</span> (<span class="id" title="var">txs</span> : <span class="id" title="var">list</span> <span class="id" title="var">MintBurnTx</span>) (<span class="id" title="var">ledger</span>: <span class="id" title="var">Ledger</span>) : <span class="id" title="var">Ledger</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">mint</span> := <span class="id" title="keyword">fun</span> (<span class="id" title="var">l</span>: <span class="id" title="var">Ledger</span>) (<span class="id" title="var">tx</span>: <span class="id" title="var">MintBurnTx</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">inc_balance</span> <span class="id" title="var">tx</span>.(<span class="id" title="var">mint_burn_owner</span>) <span class="id" title="var">tx</span>.(<span class="id" title="var">mint_burn_token_id</span>) <span class="id" title="var">tx</span>.(<span class="id" title="var">mint_burn_amount</span>) <span class="id" title="var">l</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">fold_left</span> <span class="id" title="var">mint</span> <span class="id" title="var">txs</span> <span class="id" title="var">ledger</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab101"></a><h2 class="section">Mint update total supply</h2>

</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <span class="id" title="var">mint_update_total_supply</span> (<span class="id" title="var">txs</span> : <span class="id" title="var">list</span> <span class="id" title="var">MintBurnTx</span>) (<span class="id" title="var">total_supplies</span> : <span class="id" title="var">TokenTotalSupply</span>) : <span class="id" title="var">option</span> <span class="id" title="var">TokenTotalSupply</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">update</span> := <span class="id" title="keyword">fun</span> (<span class="id" title="var">supplies_opt</span> : <span class="id" title="var">option</span> <span class="id" title="var">TokenTotalSupply</span>) (<span class="id" title="var">tx</span> : <span class="id" title="var">MintBurnTx</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">do</span> <span class="id" title="var">supplies</span> &lt;- <span class="id" title="var">supplies_opt</span> ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">do</span> <span class="id" title="var">ts</span> &lt;- <span class="id" title="var">FMap.find</span> <span class="id" title="var">tx</span>.(<span class="id" title="var">mint_burn_token_id</span>) <span class="id" title="var">supplies</span> ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">new_s</span> := <span class="id" title="var">ts</span> + <span class="id" title="var">tx</span>.(<span class="id" title="var">mint_burn_amount</span>) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Some</span> (<span class="id" title="var">FMap.update</span> <span class="id" title="var">tx</span>.(<span class="id" title="var">mint_burn_token_id</span>) (<span class="id" title="var">Some</span> <span class="id" title="var">new_s</span>) <span class="id" title="var">supplies</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">fold_left</span> <span class="id" title="var">update</span> <span class="id" title="var">txs</span> (<span class="id" title="var">Some</span> <span class="id" title="var">total_supplies</span>).<br/>

<br/>
</div>

<div class="doc">
<a name="lab102"></a><h2 class="section">Mint tokens</h2>

</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <span class="id" title="var">mint_tokens</span> (<span class="id" title="var">param</span> : <span class="id" title="var">MintBurnTokensParam</span>) (<span class="id" title="var">storage</span> : <span class="id" title="var">MultiTokenStorage</span>) : <span class="id" title="var">option</span> <span class="id" title="var">MultiTokenStorage</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">new_ledger</span> := <span class="id" title="var">mint_update_balances</span> <span class="id" title="var">param</span> <span class="id" title="var">storage</span>.(<span class="id" title="var">ledger</span>) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">do</span> <span class="id" title="var">new_supply</span> &lt;- <span class="id" title="var">mint_update_total_supply</span> <span class="id" title="var">param</span> <span class="id" title="var">storage</span>.(<span class="id" title="var">token_total_supply</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">new_s</span> := <span class="id" title="var">storage</span>&lt;|<span class="id" title="var">ledger</span> := <span class="id" title="var">new_ledger</span>|&gt;&lt;|<span class="id" title="var">token_total_supply</span> := <span class="id" title="var">new_supply</span>|&gt; <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Some</span> <span class="id" title="var">new_s</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab103"></a><h2 class="section">Burn update balances</h2>

</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <span class="id" title="var">burn_update_balances</span> (<span class="id" title="var">txs</span> : <span class="id" title="var">list</span> <span class="id" title="var">MintBurnTx</span>) (<span class="id" title="var">ledger</span> : <span class="id" title="var">Ledger</span>) : <span class="id" title="var">option</span> <span class="id" title="var">Ledger</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">burn</span> := <span class="id" title="keyword">fun</span> (<span class="id" title="var">l_opt</span> : <span class="id" title="var">option</span> <span class="id" title="var">Ledger</span>) (<span class="id" title="var">tx</span> : <span class="id" title="var">MintBurnTx</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">do</span> <span class="id" title="var">l</span> &lt;- <span class="id" title="var">l_opt</span> ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">dec_balance</span> <span class="id" title="var">tx</span>.(<span class="id" title="var">mint_burn_owner</span>) <span class="id" title="var">tx</span>.(<span class="id" title="var">mint_burn_token_id</span>) <span class="id" title="var">tx</span>.(<span class="id" title="var">mint_burn_amount</span>) <span class="id" title="var">l</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">fold_left</span> <span class="id" title="var">burn</span> <span class="id" title="var">txs</span> (<span class="id" title="var">Some</span> <span class="id" title="var">ledger</span>).<br/>

<br/>
</div>

<div class="doc">
<a name="lab104"></a><h2 class="section">Burn update total supply</h2>

</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <span class="id" title="var">burn_update_total_supply</span> (<span class="id" title="var">txs</span> : <span class="id" title="var">list</span> <span class="id" title="var">MintBurnTx</span>) (<span class="id" title="var">total_supplies</span> : <span class="id" title="var">TokenTotalSupply</span>) : <span class="id" title="var">option</span> <span class="id" title="var">TokenTotalSupply</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">update</span> := <span class="id" title="keyword">fun</span> (<span class="id" title="var">supplies_opt</span> : <span class="id" title="var">option</span> <span class="id" title="var">TokenTotalSupply</span>) (<span class="id" title="var">tx</span>: <span class="id" title="var">MintBurnTx</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">do</span> <span class="id" title="var">supplies</span> &lt;- <span class="id" title="var">supplies_opt</span> ;    <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">do</span> <span class="id" title="var">ts</span> &lt;- <span class="id" title="var">FMap.find</span> <span class="id" title="var">tx</span>.(<span class="id" title="var">mint_burn_token_id</span>) <span class="id" title="var">supplies</span> ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">do</span> <span class="id" title="var">new_s</span> &lt;- <span class="id" title="var">sub</span> <span class="id" title="var">ts</span> <span class="id" title="var">tx</span>.(<span class="id" title="var">mint_burn_amount</span>) ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Some</span> (<span class="id" title="var">FMap.update</span> <span class="id" title="var">tx</span>.(<span class="id" title="var">mint_burn_token_id</span>) (<span class="id" title="var">Some</span> <span class="id" title="var">new_s</span>) <span class="id" title="var">supplies</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">fold_left</span> <span class="id" title="var">update</span> <span class="id" title="var">txs</span> (<span class="id" title="var">Some</span> <span class="id" title="var">total_supplies</span>).<br/>

<br/>
</div>

<div class="doc">
<a name="lab105"></a><h2 class="section">Burn tokens</h2>

</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <span class="id" title="var">burn_tokens</span> (<span class="id" title="var">param</span> : <span class="id" title="var">MintBurnTokensParam</span>) (<span class="id" title="var">storage</span> : <span class="id" title="var">MultiTokenStorage</span>) : <span class="id" title="var">option</span> <span class="id" title="var">MultiTokenStorage</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">do</span> <span class="id" title="var">new_ledger</span> &lt;- <span class="id" title="var">burn_update_balances</span> <span class="id" title="var">param</span> <span class="id" title="var">storage</span>.(<span class="id" title="var">ledger</span>) ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">do</span> <span class="id" title="var">new_supply</span> &lt;- <span class="id" title="var">burn_update_total_supply</span> <span class="id" title="var">param</span> <span class="id" title="var">storage</span>.(<span class="id" title="var">token_total_supply</span>) ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">new_s</span> := <span class="id" title="var">storage</span>&lt;|<span class="id" title="var">ledger</span>:= <span class="id" title="var">new_ledger</span>|&gt;&lt;|<span class="id" title="var">token_total_supply</span> := <span class="id" title="var">new_supply</span>|&gt; <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Some</span> <span class="id" title="var">new_s</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab106"></a><h2 class="section">Token Manager Main Entrypoint</h2>

</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <span class="id" title="var">token_manager</span> (<span class="id" title="var">param</span> : <span class="id" title="var">TokenManager</span>) (<span class="id" title="var">s</span> : <span class="id" title="var">MultiTokenStorage</span>) : <span class="id" title="var">option</span> (<span class="id" title="var">MultiTokenStorage</span> * <span class="id" title="var">list</span> <span class="id" title="var">ActionBody</span>) :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">param</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">MintTokens</span> <span class="id" title="var">param</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">do</span> <span class="id" title="var">new_s</span> &lt;- <span class="id" title="var">mint_tokens</span> <span class="id" title="var">param</span> <span class="id" title="var">s</span> ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Some</span> (<span class="id" title="var">new_s</span>, [])<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">BurnTokens</span> <span class="id" title="var">param</span> =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">do</span> <span class="id" title="var">new_s</span> &lt;- <span class="id" title="var">burn_tokens</span> <span class="id" title="var">param</span> <span class="id" title="var">s</span> ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Some</span> (<span class="id" title="var">new_s</span>, [])<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">End</span> <span class="id" title="var">Token_Manager</span>.<br/>
</div>
</div>

<div id="footer">
<hr/><a href="index.html">Index</a><hr/>This page has been generated by <a href="http://coq.inria.fr/">coqdoc</a>
</div>

</div>

</body>
</html>