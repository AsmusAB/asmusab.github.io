<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<link href="coqdoc.css" rel="stylesheet" type="text/css" />
<title>FA2_Multi_Asset</title>
</head>

<body>

<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library FA2_Multi_Asset</h1>

<div class="code">
</div>

<div class="doc">
<a name="lab37"></a><h1 class="section">FA2 Multi Asset</h1>
 This is the main file for Tokens Contract

<div class="paragraph"> </div>

    The ligo implementation can be found at
    https://github.com/bender-labs/wrap-tz-contracts/blob/master/ligo/fa2/multi_asset/fa2_multi_asset.mligo

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">Blockchain</span>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">ConCert.Examples</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">FA2Interface</span>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">ConCert.Utils</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">Extras</span>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">ConCert.Execution</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">InterContractCommunication</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">Automation</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">FA2Interface_Wrap</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">RecordUpdate</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">ContractCommon</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">FA2Types</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">MultiTokenAdmin</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">TokenAdmin</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">FA2_Multi_Token</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">Token_Manager</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">Monads</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">ZArith</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">Containers</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">String</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">List</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">Fees_Lib</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">Serializable</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">FA2_Operator_Lib</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">FSets</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">FMapList</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">Psatz</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">TokenAdmin</span>.<br/>
<span class="id" title="keyword">Import</span> <span class="id" title="var">ListNotations</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab38"></a><h1 class="section">Types</h1>

</div>
<div class="code">
<span class="id" title="keyword">Section</span> <span class="id" title="var">FA2_Multi_Asset</span>.<br/>
<span class="id" title="keyword">Context</span> {<span class="id" title="var">BaseTypes</span> : <span class="id" title="var">ChainBase</span>}.<br/>
<span class="id" title="keyword">Set</span> <span class="id" title="var">Nonrecursive</span> <span class="id" title="var">Elimination</span> <span class="id" title="var">Schemes</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab39"></a><h2 class="section">Entrypoint params</h2>

</div>
<div class="code">
<span class="id" title="keyword">Inductive</span> <span class="id" title="var">MultiAssetParam</span> :=<br/>
| <span class="id" title="var">Assets</span> (<span class="id" title="var">param</span> : <span class="id" title="var">FA2EntryPoints</span>)<br/>
| <span class="id" title="var">Admin</span> (<span class="id" title="var">param</span> : <span class="id" title="var">MultiTokenAdmin</span>)<br/>
| <span class="id" title="var">Tokens</span> (<span class="id" title="var">param</span> : <span class="id" title="var">TokenManager</span>).<br/>

<br/>

<br/>
</div>

<div class="doc">
<a name="lab40"></a><h2 class="section">Setup type</h2>

</div>
<div class="code">
<span class="id" title="keyword">Record</span> <span class="id" title="var">Setup</span> := {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">admin_addr</span> : <span class="id" title="var">Address</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">minter_addr</span> : <span class="id" title="var">Address</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">tokens</span> : <span class="id" title="var">list</span> <span class="id" title="var">token_metadata</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">meta_data_uri</span> : <span class="id" title="var">N</span><br/>
}.<br/>

<br/>

<br/>
</div>

<div class="doc">
<a name="lab41"></a><h1 class="section">Implementation</h1>
<a name="lab42"></a><h2 class="section">Main entry point</h2>

</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <span class="id" title="var">main</span> (<span class="id" title="var">ctx</span> : <span class="id" title="var">ContractCallContext</span>) (<span class="id" title="var">param</span> : <span class="id" title="var">MultiAssetParam</span>) (<span class="id" title="var">s</span> : <span class="id" title="var">MultiAssetStorage</span>) : <span class="id" title="var">option</span> <span class="id" title="var">Return</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">param</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Admin</span> <span class="id" title="var">p</span> =&gt; <span class="id" title="var">multi_token_admin_main</span> <span class="id" title="var">ctx</span> <span class="id" title="var">p</span> <span class="id" title="var">s</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Tokens</span> <span class="id" title="var">p</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">do</span> <span class="id" title="var">_</span> &lt;- <span class="id" title="var">fail_if_not_minter</span> <span class="id" title="var">ctx</span> <span class="id" title="var">s</span>.(<span class="id" title="var">fa2_admin</span>) ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">do</span> <span class="id" title="var">tpl</span> &lt;- <span class="id" title="var">token_manager</span> <span class="id" title="var">p</span> <span class="id" title="var">s</span>.(<span class="id" title="var">fa2_assets</span>) ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">new_s</span> := <span class="id" title="var">s</span>&lt;| <span class="id" title="var">fa2_assets</span>:= <span class="id" title="var">fst</span> <span class="id" title="var">tpl</span> |&gt; <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Some</span> (<span class="id" title="var">new_s</span>, <span class="id" title="var">snd</span> <span class="id" title="var">tpl</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Assets</span> <span class="id" title="var">p</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">do</span> <span class="id" title="var">_</span> &lt;- <span class="id" title="var">fail_if_paused</span> <span class="id" title="var">s</span>.(<span class="id" title="var">fa2_admin</span>) <span class="id" title="var">p</span> ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">do</span> <span class="id" title="var">tpl</span> &lt;- <span class="id" title="var">fa2_main</span> <span class="id" title="var">ctx</span> <span class="id" title="var">p</span> <span class="id" title="var">s</span>.(<span class="id" title="var">fa2_assets</span>) ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">new_s</span> := <span class="id" title="var">s</span>&lt;| <span class="id" title="var">fa2_assets</span> := <span class="id" title="var">fst</span> <span class="id" title="var">tpl</span> |&gt; <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Some</span> (<span class="id" title="var">new_s</span>, <span class="id" title="var">snd</span> <span class="id" title="var">tpl</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">fa2_receive</span> (<span class="id" title="var">chain</span> : <span class="id" title="var">Chain</span>) (<span class="id" title="var">ctx</span> : <span class="id" title="var">ContractCallContext</span>) (<span class="id" title="var">state</span>: <span class="id" title="var">MultiAssetStorage</span>) (<span class="id" title="var">msg_opt</span> : <span class="id" title="var">option</span> <span class="id" title="var">MultiAssetParam</span>) : <span class="id" title="var">option</span> <span class="id" title="var">Return</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">do</span> <span class="id" title="var">msg</span> &lt;- <span class="id" title="var">msg_opt</span> ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">main</span> <span class="id" title="var">ctx</span> <span class="id" title="var">msg</span> <span class="id" title="var">state</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">fa2_init</span> (<span class="id" title="var">chain</span> : <span class="id" title="var">Chain</span>) (<span class="id" title="var">ctx</span>: <span class="id" title="var">ContractCallContext</span>) (<span class="id" title="var">setup</span>: <span class="id" title="var">Setup</span>) : <span class="id" title="var">option</span> <span class="id" title="var">MultiAssetStorage</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">admin</span> := <span class="id" title="var">setup</span>.(<span class="id" title="var">admin_addr</span>) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">minter</span> := <span class="id" title="var">setup</span>.(<span class="id" title="var">minter_addr</span>) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">tokens</span> := <span class="id" title="var">setup</span>.(<span class="id" title="var">tokens</span>) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">meta_data_uri</span> := <span class="id" title="var">setup</span>.(<span class="id" title="var">meta_data_uri</span>) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">meta</span> := <span class="id" title="var">FMap.update</span> <span class="id" title="var">EmptyString</span> (<span class="id" title="var">Some</span> <span class="id" title="var">meta_data_uri</span>) <span class="id" title="var">FMap.empty</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">token_metadata_new</span> := <span class="id" title="var">fold_right</span> (<span class="id" title="keyword">fun</span> (<span class="id" title="var">token_metadata'</span> : <span class="id" title="var">token_metadata</span>) (<span class="id" title="var">acc</span> : <span class="id" title="var">TokenMetaDataStorage</span>) =&gt; <span class="id" title="var">FMap.update</span> <span class="id" title="var">token_metadata'</span>.(<span class="id" title="var">metadata_token_id</span>) (<span class="id" title="var">Some</span> <span class="id" title="var">token_metadata'</span>) <span class="id" title="var">acc</span>) <span class="id" title="var">FMap.empty</span> <span class="id" title="var">tokens</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">supply</span> := <span class="id" title="var">fold_right</span> (<span class="id" title="keyword">fun</span> (<span class="id" title="var">token_metadata'</span> : <span class="id" title="var">token_metadata</span>) (<span class="id" title="var">acc</span> : <span class="id" title="var">TokenTotalSupply</span>) =&gt; <span class="id" title="var">FMap.update</span> <span class="id" title="var">token_metadata'</span>.(<span class="id" title="var">metadata_token_id</span>) (<span class="id" title="var">Some</span> 0) <span class="id" title="var">acc</span>) <span class="id" title="var">FMap.empty</span> <span class="id" title="var">tokens</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Some</span> ({|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">fa2_admin</span> := {|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">tas_admin</span> := <span class="id" title="var">admin</span> ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">tas_pending_admin</span> := <span class="id" title="var">None</span> ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">tas_paused</span> := <span class="id" title="var">FMap.empty</span> ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">tas_minter</span> := <span class="id" title="var">minter</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|} ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">fa2_assets</span> := {|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">ledger</span> := <span class="id" title="var">FMap.empty</span> ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">operators</span> := <span class="id" title="var">FMap.empty</span> ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">mts_token_metadata</span> := <span class="id" title="var">token_metadata_new</span> ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">token_total_supply</span> := <span class="id" title="var">supply</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|} ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">metadata</span> := <span class="id" title="var">meta</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;|}).<br/>

<br/>
</div>

<div class="doc">
The FA2 Contract 
</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <span class="id" title="var">FA2_contract</span> : <span class="id" title="var">Contract</span> <span class="id" title="var">Setup</span> <span class="id" title="var">MultiAssetParam</span> <span class="id" title="var">MultiAssetStorage</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">build_contract</span> <span class="id" title="var">fa2_init</span> <span class="id" title="var">fa2_receive</span>.<br/>

<br/>

<br/>
</div>

<div class="doc">
<a name="lab43"></a><h1 class="section">Proofs</h1>
<a name="lab44"></a><h2 class="section">Create token correct</h2>

</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">create_token_creates_new_token</span> {<span class="id" title="var">ctx</span> <span class="id" title="var">chain</span> <span class="id" title="var">prev_state</span> <span class="id" title="var">next_state</span> <span class="id" title="var">token_id</span> <span class="id" title="var">token_info</span> <span class="id" title="var">tMetaData</span>} :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">tMetaData</span> = {|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">metadata_token_id</span> := <span class="id" title="var">token_id</span> ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">metadata_token_info</span> := <span class="id" title="var">token_info</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;|} -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">fa2_receive</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">prev_state</span> (<span class="id" title="var">Some</span> (<span class="id" title="var">Admin</span> (<span class="id" title="var">Create_token</span> <span class="id" title="var">tMetaData</span>))) = <span class="id" title="var">Some</span> (<span class="id" title="var">next_state</span>, []) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">FMap.find</span> <span class="id" title="var">token_id</span> <span class="id" title="var">next_state</span>.(<span class="id" title="var">fa2_assets</span>).(<span class="id" title="var">mts_token_metadata</span>) = <span class="id" title="var">Some</span> <span class="id" title="var">tMetaData</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span> <span class="id" title="var">fa2_receive</span> <span class="id" title="var">fa2_init</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">create_token</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H1</span>. <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">FMap.find</span> <span class="id" title="var">token_id</span> (<span class="id" title="var">mts_token_metadata</span> (<span class="id" title="var">fa2_assets</span> <span class="id" title="var">prev_state</span>))) <span class="id" title="tactic">in</span> <span class="id" title="var">H1</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H1</span>. <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">FMap.find_add</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab45"></a><h2 class="section">Set new admin correct</h2>

</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">set_new_admin_functionally_correct</span> {<span class="id" title="var">ctx</span> <span class="id" title="var">chain</span> <span class="id" title="var">prev_state</span> <span class="id" title="var">next_state</span> <span class="id" title="var">new_admin</span>} :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">fa2_receive</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">prev_state</span> (<span class="id" title="var">Some</span> (<span class="id" title="var">Admin</span> (<span class="id" title="var">Token_admin</span> (<span class="id" title="var">Set_admin</span> <span class="id" title="var">new_admin</span>)))) = <span class="id" title="var">Some</span> (<span class="id" title="var">next_state</span>, []) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">next_state</span>.(<span class="id" title="var">fa2_admin</span>).(<span class="id" title="var">tas_pending_admin</span>) = <span class="id" title="var">Some</span> <span class="id" title="var">new_admin</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span> <span class="id" title="var">fa2_receive</span> <span class="id" title="var">fa2_init</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">easy</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab46"></a><h2 class="section">Set new minter correct</h2>

</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">set_new_minter_functionally_correct</span> {<span class="id" title="var">ctx</span> <span class="id" title="var">chain</span> <span class="id" title="var">prev_state</span> <span class="id" title="var">next_state</span> <span class="id" title="var">new_minter</span>} :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">fa2_receive</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">prev_state</span> (<span class="id" title="var">Some</span> (<span class="id" title="var">Admin</span> (<span class="id" title="var">Token_admin</span> (<span class="id" title="var">Set_minter</span> <span class="id" title="var">new_minter</span>)))) = <span class="id" title="var">Some</span> (<span class="id" title="var">next_state</span>, []) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">next_state</span>.(<span class="id" title="var">fa2_admin</span>).(<span class="id" title="var">tas_minter</span>) = <span class="id" title="var">new_minter</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span> <span class="id" title="var">fa2_receive</span> <span class="id" title="var">fa2_init</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">easy</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab47"></a><h2 class="section">Confirm admin correct</h2>

</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">confirm_admin_functionally_correct</span> {<span class="id" title="var">ctx</span> <span class="id" title="var">chain</span> <span class="id" title="var">prev_state</span> <span class="id" title="var">next_state</span>} :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">fa2_receive</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">prev_state</span> (<span class="id" title="var">Some</span> (<span class="id" title="var">Admin</span> (<span class="id" title="var">Token_admin</span> (<span class="id" title="var">Confirm_admin</span>)))) = <span class="id" title="var">Some</span> (<span class="id" title="var">next_state</span>, []) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">next_state</span>.(<span class="id" title="var">fa2_admin</span>).(<span class="id" title="var">tas_pending_admin</span>) = <span class="id" title="var">None</span> /\ <span class="id" title="var">next_state</span>.(<span class="id" title="var">fa2_admin</span>).(<span class="id" title="var">tas_admin</span>) = <span class="id" title="var">ctx</span>.(<span class="id" title="var">ctx_from</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span> <span class="id" title="var">fa2_receive</span> <span class="id" title="var">fa2_init</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">confirm_new_admin</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">tas_pending_admin</span> (<span class="id" title="var">fa2_admin</span> <span class="id" title="var">prev_state</span>)); <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">address_eqb</span> <span class="id" title="var">ctx</span>.(<span class="id" title="var">ctx_from</span>) <span class="id" title="var">a</span>) <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">easy</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab48"></a><h2 class="section">Pause correct</h2>

</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">pause_functionally_correct</span> {<span class="id" title="var">ctx</span> <span class="id" title="var">chain</span> <span class="id" title="var">prev_state</span> <span class="id" title="var">next_state</span> <span class="id" title="var">tokens</span> <span class="id" title="var">token_id</span>} :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">tokens</span> = [{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">pp_token_id</span> := <span class="id" title="var">token_id</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">pp_paused</span> := <span class="id" title="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;|}] -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">fa2_receive</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">prev_state</span> (<span class="id" title="var">Some</span> (<span class="id" title="var">Admin</span> (<span class="id" title="var">Token_admin</span> (<span class="id" title="var">Pause</span> <span class="id" title="var">tokens</span>)))) = <span class="id" title="var">Some</span> (<span class="id" title="var">next_state</span>, []) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">FMap.find</span> <span class="id" title="var">token_id</span> <span class="id" title="var">next_state</span>.(<span class="id" title="var">fa2_admin</span>).(<span class="id" title="var">tas_paused</span>) = <span class="id" title="var">Some</span> <span class="id" title="var">tt</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span> <span class="id" title="var">fa2_receive</span> <span class="id" title="var">fa2_init</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">FMap.find_add</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab49"></a><h2 class="section">Unpause correct</h2>

</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">unpause_functionally_correct</span> {<span class="id" title="var">ctx</span> <span class="id" title="var">chain</span> <span class="id" title="var">prev_state</span> <span class="id" title="var">next_state</span> <span class="id" title="var">tokens</span> <span class="id" title="var">token_id</span>} :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">tokens</span> = [{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">pp_token_id</span> := <span class="id" title="var">token_id</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">pp_paused</span> := <span class="id" title="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;|}] -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">fa2_receive</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">prev_state</span> (<span class="id" title="var">Some</span> (<span class="id" title="var">Admin</span> (<span class="id" title="var">Token_admin</span> (<span class="id" title="var">Pause</span> <span class="id" title="var">tokens</span>)))) = <span class="id" title="var">Some</span> (<span class="id" title="var">next_state</span>, []) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">FMap.find</span> <span class="id" title="var">token_id</span> <span class="id" title="var">next_state</span>.(<span class="id" title="var">fa2_admin</span>).(<span class="id" title="var">tas_paused</span>) = <span class="id" title="var">None</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span> <span class="id" title="var">fa2_receive</span> <span class="id" title="var">fa2_init</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">FMap.find_remove</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab50"></a><h2 class="section">Balance of callback correct</h2>

</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">balance_of_callbacks_with_balance_of</span> {<span class="id" title="var">p</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">state</span> <span class="id" title="var">req_addr</span> <span class="id" title="var">req_token_id</span> <span class="id" title="var">req</span> <span class="id" title="var">acts</span>} :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">req</span> = <br/>
&nbsp;&nbsp;&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">owner</span> := <span class="id" title="var">req_addr</span> ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">bal_req_token_id</span> := <span class="id" title="var">req_token_id</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;|} -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">p</span>.(<span class="id" title="var">bal_requests</span>) = [<span class="id" title="var">req</span>] -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">fa2_receive</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">state</span> (<span class="id" title="var">Some</span> (<span class="id" title="var">Assets</span> (<span class="id" title="var">Balance_of</span> (<span class="id" title="var">p</span>)))) = <span class="id" title="var">Some</span> (<span class="id" title="var">state</span>, <span class="id" title="var">acts</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">acts</span> = [<span class="id" title="var">act_call</span> <span class="id" title="var">p</span>.(<span class="id" title="var">bal_callback</span>) 0 (<span class="id" title="var">serialize</span> [{|<span class="id" title="var">request</span> := <span class="id" title="var">req</span>; <span class="id" title="var">balance</span>:=(<span class="id" title="var">get_balance_amt</span> (<span class="id" title="var">req</span>.(<span class="id" title="var">owner</span>), <span class="id" title="var">req</span>.(<span class="id" title="var">bal_req_token_id</span>)) <span class="id" title="var">state</span>.(<span class="id" title="var">fa2_assets</span>).(<span class="id" title="var">ledger</span>)) |}])].<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span> <span class="id" title="var">fa2_receive</span> <span class="id" title="var">fa2_init</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H0</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H1</span>. <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">FMap.find</span> <span class="id" title="var">req_token_id</span> (<span class="id" title="var">mts_token_metadata</span> (<span class="id" title="var">fa2_assets</span> <span class="id" title="var">state</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">inversion</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">discriminate</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab51"></a><h2 class="section">Transfer preserves total supply</h2>

</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">transfer_preserves_total_supply</span> {<span class="id" title="var">prev_state</span> <span class="id" title="var">next_state</span> <span class="id" title="var">acts</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">transfers</span>} :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">fa2_receive</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">prev_state</span> (<span class="id" title="var">Some</span> (<span class="id" title="var">Assets</span> (<span class="id" title="var">FA2_Transfer</span> <span class="id" title="var">transfers</span>))) = <span class="id" title="var">Some</span> (<span class="id" title="var">next_state</span>, <span class="id" title="var">acts</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">prev_state</span>.(<span class="id" title="var">fa2_assets</span>).(<span class="id" title="var">token_total_supply</span>) = <span class="id" title="var">next_state</span>.(<span class="id" title="var">fa2_assets</span>).(<span class="id" title="var">token_total_supply</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span> <span class="id" title="var">fa2_receive</span> <span class="id" title="var">fa2_init</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab52"></a><h2 class="section">Inc on one balance preserves others</h2>

</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">inc_balance_other_preservces_own</span> {<span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="var">ledger</span> <span class="id" title="var">amount</span> <span class="id" title="var">token_id'</span> <span class="id" title="var">token_id</span>} :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">x</span> &lt;&gt; <span class="id" title="var">y</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">FMap.find</span> (<span class="id" title="var">x</span>, <span class="id" title="var">token_id'</span>) <span class="id" title="var">ledger</span> = <span class="id" title="var">FMap.find</span> (<span class="id" title="var">x</span>, <span class="id" title="var">token_id'</span>) (<span class="id" title="var">inc_balance</span> <span class="id" title="var">y</span> <span class="id" title="var">token_id</span> <span class="id" title="var">amount</span> <span class="id" title="var">ledger</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">inc_balance</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">get_balance_amt</span> (<span class="id" title="var">y</span>, <span class="id" title="var">token_id</span>) <span class="id" title="var">ledger</span> + <span class="id" title="var">amount</span> =? 0).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">FMap.find_remove_ne</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">cbn</span>. <span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">FMap.find_add_ne</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab53"></a><h2 class="section">Transfer correct</h2>

</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">transfer_is_functionally_correct</span> {<span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">prev_state</span> <span class="id" title="var">next_state</span> <span class="id" title="var">acts</span> <span class="id" title="var">fromAddr</span> <span class="id" title="var">toAddr</span> <span class="id" title="var">amount</span> <span class="id" title="var">token_id</span>} :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">fromAddr</span> &lt;&gt; <span class="id" title="var">toAddr</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">fa2_receive</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">prev_state</span> (<span class="id" title="var">Some</span> (<span class="id" title="var">Assets</span> (<span class="id" title="var">FA2_Transfer</span> [{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">from_</span> := <span class="id" title="var">fromAddr</span> ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">txs</span> := [{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">to_</span> := <span class="id" title="var">toAddr</span> ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">dst_token_id</span> := <span class="id" title="var">token_id</span> ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">amount</span> := <span class="id" title="var">amount</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|}]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;|}]))) = <span class="id" title="var">Some</span> (<span class="id" title="var">next_state</span>, <span class="id" title="var">acts</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">get_balance_amt</span> (<span class="id" title="var">fromAddr</span>, <span class="id" title="var">token_id</span>) <span class="id" title="var">next_state</span>.(<span class="id" title="var">fa2_assets</span>).(<span class="id" title="var">ledger</span>) = <span class="id" title="var">get_balance_amt</span> (<span class="id" title="var">fromAddr</span>, <span class="id" title="var">token_id</span>) <span class="id" title="var">prev_state</span>.(<span class="id" title="var">fa2_assets</span>).(<span class="id" title="var">ledger</span>) - <span class="id" title="var">amount</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">get_balance_amt</span> (<span class="id" title="var">toAddr</span>, <span class="id" title="var">token_id</span>) <span class="id" title="var">next_state</span>.(<span class="id" title="var">fa2_assets</span>).(<span class="id" title="var">ledger</span>) = <span class="id" title="var">get_balance_amt</span> (<span class="id" title="var">toAddr</span>, <span class="id" title="var">token_id</span>) <span class="id" title="var">prev_state</span>.(<span class="id" title="var">fa2_assets</span>).(<span class="id" title="var">ledger</span>) + <span class="id" title="var">amount</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span> <span class="id" title="var">fa2_receive</span> <span class="id" title="var">fa2_init</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">unfold</span> <span class="id" title="var">get_balance_amt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">FMap.find</span> (<span class="id" title="var">fromAddr</span>, <span class="id" title="var">token_id</span>) (<span class="id" title="var">ledger</span> (<span class="id" title="var">fa2_assets</span> <span class="id" title="var">prev_state</span>))) <span class="id" title="var">eqn</span>: <span class="id" title="var">E</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">E</span>. <span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">E</span>. <span class="id" title="tactic">destruct</span> (<span class="id" title="var">n</span>-<span class="id" title="var">amount</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">inc_balance_other_preservces_own</span>; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">FMap.find_remove</span>. <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">inc_balance_other_preservces_own</span>; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">FMap.find_add</span>. <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">E</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">E</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cbn</span>. <span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">inc_balance_other_preservces_own</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">FMap.find_remove</span>. <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">unfold</span> <span class="id" title="var">get_balance_amt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">FMap.find</span> (<span class="id" title="var">fromAddr</span>, <span class="id" title="var">token_id</span>) (<span class="id" title="var">ledger</span> (<span class="id" title="var">fa2_assets</span> <span class="id" title="var">prev_state</span>))) <span class="id" title="var">eqn</span>: <span class="id" title="var">E</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">do</span> 2 <span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">E</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">destruct</span> (<span class="id" title="var">n</span>-<span class="id" title="var">amount</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id" title="tactic">unfold</span> <span class="id" title="var">inc_balance</span>. <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">FMap.find</span> (<span class="id" title="var">toAddr</span>, <span class="id" title="var">token_id</span>) (<span class="id" title="var">ledger</span> (<span class="id" title="var">fa2_assets</span> <span class="id" title="var">prev_state</span>))) <span class="id" title="var">eqn</span>: <span class="id" title="var">E1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id" title="tactic">unfold</span> <span class="id" title="var">get_balance_amt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">FMap.find_remove_ne</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">E1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">n0</span>+<span class="id" title="var">amount</span>) <span class="id" title="var">eqn</span>: <span class="id" title="var">E2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--- <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">FMap.find_remove</span>. <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--- <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">FMap.find_add</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">FMap.find_remove_ne</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">E1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id" title="tactic">unfold</span> <span class="id" title="var">get_balance_amt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">FMap.find_remove_ne</span>; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>. <span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">E1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (0+<span class="id" title="var">amount</span>) <span class="id" title="var">eqn</span>: <span class="id" title="var">E2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--- <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">FMap.find_remove</span>. <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--- <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">FMap.find_add</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">FMap.find_remove_ne</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">E1</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id" title="var">cbn</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">inc_balance</span>. <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">FMap.find</span> (<span class="id" title="var">toAddr</span>, <span class="id" title="var">token_id</span>) (<span class="id" title="var">ledger</span> (<span class="id" title="var">fa2_assets</span> <span class="id" title="var">prev_state</span>))) <span class="id" title="var">eqn</span>: <span class="id" title="var">E1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id" title="tactic">unfold</span> <span class="id" title="var">get_balance_amt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">FMap.find_add_ne</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">E1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">n0</span>+<span class="id" title="var">amount</span>) <span class="id" title="var">eqn</span>: <span class="id" title="var">E2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--- <span class="id" title="var">cbn</span>. <span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">FMap.find_remove</span>. <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--- <span class="id" title="var">cbn</span>. <span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">FMap.find_add</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">FMap.find_add_ne</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">E1</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id" title="tactic">unfold</span> <span class="id" title="var">get_balance_amt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">FMap.find_add_ne</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">E1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (0+<span class="id" title="var">amount</span>) <span class="id" title="var">eqn</span>: <span class="id" title="var">E2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--- <span class="id" title="var">cbn</span>. <span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">FMap.find_remove</span>. <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--- <span class="id" title="var">cbn</span>. <span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">FMap.find_add</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">FMap.find_add_ne</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">E1</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">unfold</span> <span class="id" title="var">inc_balance</span>. <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">FMap.find</span> (<span class="id" title="var">toAddr</span>, <span class="id" title="var">token_id</span>) (<span class="id" title="var">ledger</span> (<span class="id" title="var">fa2_assets</span> <span class="id" title="var">prev_state</span>))) <span class="id" title="var">eqn</span>: <span class="id" title="var">E1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id" title="tactic">unfold</span> <span class="id" title="var">get_balance_amt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">FMap.find_remove_ne</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">FMap.find_remove_ne</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">E1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">n</span> + <span class="id" title="var">amount</span>) <span class="id" title="var">eqn</span>: <span class="id" title="var">E2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id" title="var">cbn</span>. <span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">FMap.find_remove</span>. <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id" title="var">cbn</span>. <span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">FMap.find_add</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">E1</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id" title="tactic">unfold</span> <span class="id" title="var">get_balance_amt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">FMap.find_remove_ne</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">FMap.find_remove_ne</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">E1</span>. <span class="id" title="tactic">destruct</span> (0 + <span class="id" title="var">amount</span>) <span class="id" title="var">eqn</span>: <span class="id" title="var">E2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id" title="var">cbn</span>. <span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">FMap.find_remove</span>. <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id" title="var">cbn</span>. <span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">FMap.find_add</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">E1</span>. <span class="id" title="tactic">assumption</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab54"></a><h2 class="section">Transfer to self changes nothing</h2>

</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">transfer_to_self_changes_nothing</span> {<span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">prev_state</span> <span class="id" title="var">next_state</span> <span class="id" title="var">acts</span> <span class="id" title="var">fromAddr</span> <span class="id" title="var">toAddr</span> <span class="id" title="var">amount</span> <span class="id" title="var">token_id</span>} :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">fromAddr</span> = <span class="id" title="var">toAddr</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">fa2_receive</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">prev_state</span> (<span class="id" title="var">Some</span> (<span class="id" title="var">Assets</span> (<span class="id" title="var">FA2_Transfer</span> [{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">from_</span> := <span class="id" title="var">fromAddr</span> ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">txs</span> := [{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">to_</span> := <span class="id" title="var">toAddr</span> ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">dst_token_id</span> := <span class="id" title="var">token_id</span> ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">amount</span> := <span class="id" title="var">amount</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|}]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;|}]))) = <span class="id" title="var">Some</span> (<span class="id" title="var">next_state</span>, <span class="id" title="var">acts</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">get_balance_amt</span> (<span class="id" title="var">fromAddr</span>, <span class="id" title="var">token_id</span>) <span class="id" title="var">next_state</span>.(<span class="id" title="var">fa2_assets</span>).(<span class="id" title="var">ledger</span>) = <span class="id" title="var">get_balance_amt</span> (<span class="id" title="var">fromAddr</span>, <span class="id" title="var">token_id</span>) <span class="id" title="var">prev_state</span>.(<span class="id" title="var">fa2_assets</span>).(<span class="id" title="var">ledger</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span> <span class="id" title="var">fa2_receive</span> <span class="id" title="var">fa2_init</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">get_balance_amt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">FMap.find</span> (<span class="id" title="var">toAddr</span>, <span class="id" title="var">token_id</span>) (<span class="id" title="var">ledger</span> (<span class="id" title="var">fa2_assets</span> <span class="id" title="var">prev_state</span>))) <span class="id" title="var">eqn</span>: <span class="id" title="var">E</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">do</span> 2 <span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">E</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">unfold</span> <span class="id" title="var">get_balance_amt</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">E</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">n</span>-<span class="id" title="var">amount</span>) <span class="id" title="var">eqn</span>: <span class="id" title="var">E2</span>; <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">unfold</span> <span class="id" title="var">inc_balance</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">get_balance_amt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">FMap.find_remove</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">FMap.find_remove</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cbn</span>. <span class="id" title="tactic">destruct</span> (0+<span class="id" title="var">amount</span>) <span class="id" title="var">eqn</span>: <span class="id" title="var">E3</span>; <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">FMap.find_remove</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">E2</span> <span class="id" title="tactic">in</span> <span class="id" title="var">E3</span>. <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">FMap.find_add</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">N.ltb_ge</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">n</span>; <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">unfold</span> <span class="id" title="var">inc_balance</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">get_balance_amt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">FMap.find_add</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">FMap.find_add</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">N.pos</span> <span class="id" title="var">p</span> + <span class="id" title="var">amount</span>) <span class="id" title="var">eqn</span>: <span class="id" title="var">E3</span>; <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">FMap.find_remove</span>. <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">FMap.find_add</span>. <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">unfold</span> <span class="id" title="var">inc_balance</span>. <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">get_balance_amt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">FMap.find_remove</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">FMap.find_remove</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (0 + <span class="id" title="var">amount</span>) <span class="id" title="var">eqn</span>: <span class="id" title="var">E2</span>; <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">FMap.find_remove</span>; <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">FMap.find_add</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">get_balance_amt</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">E</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">N.ltb_ge</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H3</span>. <span class="id" title="var">easy</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab55"></a><h2 class="section">Mint correct</h2>

</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">mint_functionally_correct</span> {<span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">prev_state</span> <span class="id" title="var">owner</span> <span class="id" title="var">token_id</span> <span class="id" title="var">amount</span> <span class="id" title="var">next_state</span> <span class="id" title="var">acts</span> <span class="id" title="var">old_value</span> <span class="id" title="var">v</span>} :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">fa2_receive</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">prev_state</span> (<span class="id" title="var">Some</span> (<span class="id" title="var">Tokens</span> (<span class="id" title="var">MintTokens</span> [{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">mint_burn_owner</span> := <span class="id" title="var">owner</span> ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">mint_burn_token_id</span> := <span class="id" title="var">token_id</span> ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">mint_burn_amount</span> := <span class="id" title="var">amount</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|}]))) = <span class="id" title="var">Some</span> (<span class="id" title="var">next_state</span>, <span class="id" title="var">acts</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">FMap.find</span> <span class="id" title="var">token_id</span> (<span class="id" title="var">prev_state</span>.(<span class="id" title="var">fa2_assets</span>).(<span class="id" title="var">token_total_supply</span>)) = <span class="id" title="var">Some</span> <span class="id" title="var">old_value</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">FMap.find</span> <span class="id" title="var">token_id</span> (<span class="id" title="var">next_state</span>.(<span class="id" title="var">fa2_assets</span>).(<span class="id" title="var">token_total_supply</span>)) = <span class="id" title="var">Some</span> <span class="id" title="var">v</span> -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">old_value</span> + <span class="id" title="var">amount</span> = <span class="id" title="var">v</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">get_balance_amt</span> (<span class="id" title="var">owner</span>, <span class="id" title="var">token_id</span>) <span class="id" title="var">prev_state</span>.(<span class="id" title="var">fa2_assets</span>).(<span class="id" title="var">ledger</span>) + <span class="id" title="var">amount</span> = <span class="id" title="var">get_balance_amt</span> (<span class="id" title="var">owner</span>, <span class="id" title="var">token_id</span>) <span class="id" title="var">next_state</span>.(<span class="id" title="var">fa2_assets</span>).(<span class="id" title="var">ledger</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span> <span class="id" title="var">fa2_receive</span> <span class="id" title="var">fa2_init</span>. <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">FMap.find_add</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">H0</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H1</span>. <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">unfold</span> <span class="id" title="var">inc_balance</span>. <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">get_balance_amt</span> (<span class="id" title="var">owner</span>, <span class="id" title="var">token_id</span>) (<span class="id" title="var">ledger</span> (<span class="id" title="var">fa2_assets</span> <span class="id" title="var">prev_state</span>)) + <span class="id" title="var">amount</span>) <span class="id" title="var">eqn</span>: <span class="id" title="var">E</span>; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cbn</span>; <span class="id" title="tactic">unfold</span> <span class="id" title="var">get_balance_amt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">FMap.find_remove</span>. <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">FMap.find_add</span>. <span class="id" title="var">easy</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab56"></a><h2 class="section">Burn correct</h2>

</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">burn_functionally_correct</span> {<span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">prev_state</span> <span class="id" title="var">owner</span> <span class="id" title="var">token_id</span> <span class="id" title="var">amount</span> <span class="id" title="var">next_state</span> <span class="id" title="var">acts</span> <span class="id" title="var">old_value</span> <span class="id" title="var">v</span>} :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">fa2_receive</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">prev_state</span> (<span class="id" title="var">Some</span> (<span class="id" title="var">Tokens</span> (<span class="id" title="var">BurnTokens</span> [{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">mint_burn_owner</span> := <span class="id" title="var">owner</span> ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">mint_burn_token_id</span> := <span class="id" title="var">token_id</span> ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">mint_burn_amount</span> := <span class="id" title="var">amount</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|}]))) = <span class="id" title="var">Some</span> (<span class="id" title="var">next_state</span>, <span class="id" title="var">acts</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">FMap.find</span> <span class="id" title="var">token_id</span> (<span class="id" title="var">prev_state</span>.(<span class="id" title="var">fa2_assets</span>).(<span class="id" title="var">token_total_supply</span>)) = <span class="id" title="var">Some</span> <span class="id" title="var">old_value</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">FMap.find</span> <span class="id" title="var">token_id</span> (<span class="id" title="var">next_state</span>.(<span class="id" title="var">fa2_assets</span>).(<span class="id" title="var">token_total_supply</span>)) = <span class="id" title="var">Some</span> <span class="id" title="var">v</span> -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">old_value</span> - <span class="id" title="var">amount</span> = <span class="id" title="var">v</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">get_balance_amt</span> (<span class="id" title="var">owner</span>, <span class="id" title="var">token_id</span>) <span class="id" title="var">prev_state</span>.(<span class="id" title="var">fa2_assets</span>).(<span class="id" title="var">ledger</span>) - <span class="id" title="var">amount</span> = <span class="id" title="var">get_balance_amt</span> (<span class="id" title="var">owner</span>, <span class="id" title="var">token_id</span>) <span class="id" title="var">next_state</span>.(<span class="id" title="var">fa2_assets</span>).(<span class="id" title="var">ledger</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>. <span class="id" title="var">contract_simpl</span> <span class="id" title="var">fa2_receive</span> <span class="id" title="var">fa2_init</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H1</span>. <span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">FMap.find_add</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">H0</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H1</span>. <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">unfold</span> <span class="id" title="var">inc_balance</span>. <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">get_balance_amt</span> (<span class="id" title="var">owner</span>, <span class="id" title="var">token_id</span>) (<span class="id" title="var">ledger</span> (<span class="id" title="var">fa2_assets</span> <span class="id" title="var">prev_state</span>)) - <span class="id" title="var">amount</span>) <span class="id" title="var">eqn</span>: <span class="id" title="var">E</span>; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cbn</span>; <span class="id" title="tactic">unfold</span> <span class="id" title="var">get_balance_amt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">FMap.find_remove</span>. <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">FMap.find_add</span>. <span class="id" title="var">easy</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab57"></a><h2 class="section">Only minter can mint and burn</h2>

</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">only_minter_can_mint_and_burn</span> {<span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">prev_state</span> <span class="id" title="var">p</span>} :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">ctx</span>.(<span class="id" title="var">ctx_from</span>) =? <span class="id" title="var">prev_state</span>.(<span class="id" title="var">fa2_admin</span>).(<span class="id" title="var">tas_minter</span>))%<span class="id" title="var">address</span> = <span class="id" title="var">false</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">fa2_receive</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">prev_state</span> (<span class="id" title="var">Some</span> (<span class="id" title="var">Tokens</span> <span class="id" title="var">p</span>)) = <span class="id" title="var">None</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span> <span class="id" title="var">fa2_receive</span> <span class="id" title="var">fa2_init</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">fail_if_not_minter</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab58"></a><h2 class="section">Can't burn more than supply</h2>

</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">cant_burn_more_than_supply</span> {<span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">prev_state</span> <span class="id" title="var">owner</span> <span class="id" title="var">token_id</span> <span class="id" title="var">amount</span> <span class="id" title="var">v</span>} :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">FMap.find</span> <span class="id" title="var">token_id</span> (<span class="id" title="var">prev_state</span>.(<span class="id" title="var">fa2_assets</span>).(<span class="id" title="var">token_total_supply</span>)) = <span class="id" title="var">Some</span> <span class="id" title="var">v</span> -&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">v</span> &lt; <span class="id" title="var">amount</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">fa2_receive</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">prev_state</span> (<span class="id" title="var">Some</span> (<span class="id" title="var">Tokens</span> (<span class="id" title="var">BurnTokens</span> [{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">mint_burn_owner</span> := <span class="id" title="var">owner</span> ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">mint_burn_token_id</span> := <span class="id" title="var">token_id</span> ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">mint_burn_amount</span> := <span class="id" title="var">amount</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;|}]))) = <span class="id" title="var">None</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span> <span class="id" title="var">fa2_receive</span> <span class="id" title="var">fa2_init</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">fail_if_not_minter</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">address_eqb</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">get_balance_amt</span> (<span class="id" title="var">owner</span>, <span class="id" title="var">token_id</span>) (<span class="id" title="var">ledger</span> (<span class="id" title="var">fa2_assets</span> <span class="id" title="var">prev_state</span>)) &lt;? <span class="id" title="var">amount</span>); <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>. <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">destruct</span> (<span class="id" title="var">v</span> &lt;? <span class="id" title="var">amount</span>) <span class="id" title="var">eqn</span>: <span class="id" title="var">E</span>; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">N.ltb_ge</span> <span class="id" title="tactic">in</span> <span class="id" title="var">E</span>. <span class="id" title="var">easy</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab59"></a><h2 class="section">Init total supply correct</h2>

</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">init_total_supply_correct</span> {<span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">setup</span> <span class="id" title="var">state</span> <span class="id" title="var">fa2_token_id</span> <span class="id" title="var">total_supply</span>} :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">FMap.find</span> <span class="id" title="var">fa2_token_id</span> <span class="id" title="var">state</span>.(<span class="id" title="var">fa2_assets</span>).(<span class="id" title="var">token_total_supply</span>) = <span class="id" title="var">Some</span> <span class="id" title="var">total_supply</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">fa2_init</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">setup</span> = <span class="id" title="var">Some</span> <span class="id" title="var">state</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">total_supply</span> = 0.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span> <span class="id" title="var">fa2_receive</span> <span class="id" title="var">fa2_init</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">tokens</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">FMap.find_empty</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> *. <span class="id" title="tactic">destruct</span> (<span class="id" title="var">fa2_token_id</span> =? (<span class="id" title="var">metadata_token_id</span> <span class="id" title="var">a</span>)) <span class="id" title="var">eqn</span>:<span class="id" title="var">E</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">rewrite</span> <span class="id" title="var">N.eqb_eq</span> <span class="id" title="tactic">in</span> <span class="id" title="var">E</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">FMap.find_add</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>. <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">rewrite</span> <span class="id" title="var">N.eqb_neq</span> <span class="id" title="tactic">in</span> <span class="id" title="var">E</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">FMap.find_add_ne</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab60"></a><h1 class="section">Safety proofs</h1>

</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <span class="id" title="var">sum_tx</span> (<span class="id" title="var">txs</span> : <span class="id" title="var">list</span> <span class="id" title="var">MintBurnTx</span>) (<span class="id" title="var">id</span> : <span class="id" title="var">token_id</span>): <span class="id" title="var">Z</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">fold_right</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> (<span class="id" title="var">tx</span> : <span class="id" title="var">MintBurnTx</span>) (<span class="id" title="var">acc</span> : <span class="id" title="var">Z</span>) =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> <span class="id" title="var">tx</span>.(<span class="id" title="var">mint_burn_token_id</span>) =? <span class="id" title="var">id</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">then</span> (<span class="id" title="var">acc</span> + (<span class="id" title="var">Z.of_N</span> <span class="id" title="var">tx</span>.(<span class="id" title="var">mint_burn_amount</span>)))%<span class="id" title="var">Z</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span> 0%<span class="id" title="var">Z</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0%<span class="id" title="var">Z</span> <span class="id" title="var">txs</span>.<br/>

<br/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">mint_or_burn</span> (<span class="id" title="var">id</span> : <span class="id" title="var">token_id</span>) (<span class="id" title="var">msg</span> : <span class="id" title="var">option</span> <span class="id" title="var">MultiAssetParam</span>) : <span class="id" title="var">Z</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">msg</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Some</span> <span class="id" title="var">m</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">m</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Tokens</span> (<span class="id" title="var">param</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">param</span> <span class="id" title="keyword">with</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">MintTokens</span> <span class="id" title="var">mint_param</span> =&gt; <span class="id" title="var">sum_tx</span> <span class="id" title="var">mint_param</span> <span class="id" title="var">id</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">BurnTokens</span> <span class="id" title="var">mint_param</span> =&gt; (<span class="id" title="var">sum_tx</span> <span class="id" title="var">mint_param</span> <span class="id" title="var">id</span>) * (-1)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; 0<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span> =&gt; 0<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab61"></a><h2 class="section">Assets endpoint does not change minter</h2>

</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">assets_endpoint_does_not_change_minter</span> {<span class="id" title="var">prev_state</span> <span class="id" title="var">next_state</span> <span class="id" title="var">acts</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">param</span>} :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">fa2_receive</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">prev_state</span> (<span class="id" title="var">Some</span> (<span class="id" title="var">Assets</span> <span class="id" title="var">param</span>)) = <span class="id" title="var">Some</span> (<span class="id" title="var">next_state</span>, <span class="id" title="var">acts</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">prev_state</span>.(<span class="id" title="var">fa2_admin</span>).(<span class="id" title="var">tas_minter</span>) = <span class="id" title="var">next_state</span>.(<span class="id" title="var">fa2_admin</span>).(<span class="id" title="var">tas_minter</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>; <span class="id" title="var">now</span> <span class="id" title="var">contract_simpl</span> <span class="id" title="var">fa2_receive</span> <span class="id" title="var">fa2_init</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab62"></a><h2 class="section">Assets endpoint preserves total supply</h2>

</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">assets_endpoint_preserves_total_supply</span> {<span class="id" title="var">prev_state</span> <span class="id" title="var">next_state</span> <span class="id" title="var">acts</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">param</span>} :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">fa2_receive</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">prev_state</span> (<span class="id" title="var">Some</span> (<span class="id" title="var">Assets</span> <span class="id" title="var">param</span>)) = <span class="id" title="var">Some</span> (<span class="id" title="var">next_state</span>, <span class="id" title="var">acts</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">prev_state</span>.(<span class="id" title="var">fa2_assets</span>).(<span class="id" title="var">token_total_supply</span>) = <span class="id" title="var">next_state</span>.(<span class="id" title="var">fa2_assets</span>).(<span class="id" title="var">token_total_supply</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span> <span class="id" title="var">fa2_receive</span> <span class="id" title="var">fa2_init</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">param</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">inversion</span> <span class="id" title="var">H1</span>; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">transfer</span> <span class="id" title="var">ctx</span> <span class="id" title="var">transfers</span> <span class="id" title="var">default_operator_validator</span> (<span class="id" title="var">fa2_assets</span> <span class="id" title="var">prev_state</span>)) <span class="id" title="tactic">in</span> <span class="id" title="var">H2</span>; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>; <span class="id" title="var">now</span> <span class="id" title="tactic">inversion</span> <span class="id" title="var">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">inversion</span> <span class="id" title="var">H1</span>; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">get_balance</span> <span class="id" title="var">balanceOf</span> (<span class="id" title="var">ledger</span> (<span class="id" title="var">fa2_assets</span> <span class="id" title="var">prev_state</span>)) (<span class="id" title="var">mts_token_metadata</span> (<span class="id" title="var">fa2_assets</span> <span class="id" title="var">prev_state</span>))) <span class="id" title="tactic">in</span> <span class="id" title="var">H2</span>; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>; <span class="id" title="var">now</span> <span class="id" title="tactic">inversion</span> <span class="id" title="var">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">inversion</span> <span class="id" title="var">H1</span>; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">fa2_update_operators</span> <span class="id" title="var">ctx</span> <span class="id" title="var">updates</span> (<span class="id" title="var">operators</span> (<span class="id" title="var">fa2_assets</span> <span class="id" title="var">prev_state</span>))) <span class="id" title="tactic">in</span> <span class="id" title="var">H2</span>; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>; <span class="id" title="var">now</span> <span class="id" title="tactic">inversion</span> <span class="id" title="var">H2</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab63"></a><h2 class="section">Assets endpoint preserves metadata</h2>

</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">assets_endpoint_preserves_metadata</span> {<span class="id" title="var">prev_state</span> <span class="id" title="var">next_state</span> <span class="id" title="var">acts</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">param</span>} :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">fa2_receive</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">prev_state</span> (<span class="id" title="var">Some</span> (<span class="id" title="var">Assets</span> <span class="id" title="var">param</span>)) = <span class="id" title="var">Some</span> (<span class="id" title="var">next_state</span>, <span class="id" title="var">acts</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">prev_state</span>.(<span class="id" title="var">fa2_assets</span>).(<span class="id" title="var">mts_token_metadata</span>) = <span class="id" title="var">next_state</span>.(<span class="id" title="var">fa2_assets</span>).(<span class="id" title="var">mts_token_metadata</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span> <span class="id" title="var">fa2_receive</span> <span class="id" title="var">fa2_init</span>. <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">param</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">inversion</span> <span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">transfer</span> <span class="id" title="var">ctx</span> <span class="id" title="var">transfers</span> <span class="id" title="var">default_operator_validator</span> (<span class="id" title="var">fa2_assets</span> <span class="id" title="var">prev_state</span>)) <span class="id" title="tactic">in</span> <span class="id" title="var">H2</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">inversion</span> <span class="id" title="var">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">inversion</span> <span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">get_balance</span> <span class="id" title="var">balanceOf</span> (<span class="id" title="var">ledger</span> (<span class="id" title="var">fa2_assets</span> <span class="id" title="var">prev_state</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">mts_token_metadata</span> (<span class="id" title="var">fa2_assets</span> <span class="id" title="var">prev_state</span>))); <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">inversion</span> <span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">fa2_update_operators</span> <span class="id" title="var">ctx</span> <span class="id" title="var">updates</span> (<span class="id" title="var">operators</span> (<span class="id" title="var">fa2_assets</span> <span class="id" title="var">prev_state</span>))); <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab64"></a><h2 class="section">Token metadata for a token does not change for admin endpoint</h2>

</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">token_metadata_always_same</span> {<span class="id" title="var">prev_state</span> <span class="id" title="var">next_state</span> <span class="id" title="var">acts</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">param</span> <span class="id" title="var">fa2_token_id</span> <span class="id" title="var">metadata</span>} :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">FMap.find</span> <span class="id" title="var">fa2_token_id</span> <span class="id" title="var">prev_state</span>.(<span class="id" title="var">fa2_assets</span>).(<span class="id" title="var">mts_token_metadata</span>) = <span class="id" title="var">Some</span> <span class="id" title="var">metadata</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">fa2_receive</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">prev_state</span> (<span class="id" title="var">Some</span> (<span class="id" title="var">Admin</span> <span class="id" title="var">param</span>)) = <span class="id" title="var">Some</span> (<span class="id" title="var">next_state</span>, <span class="id" title="var">acts</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">FMap.find</span> <span class="id" title="var">fa2_token_id</span> <span class="id" title="var">prev_state</span>.(<span class="id" title="var">fa2_assets</span>).(<span class="id" title="var">mts_token_metadata</span>) = <span class="id" title="var">FMap.find</span> <span class="id" title="var">fa2_token_id</span> <span class="id" title="var">next_state</span>.(<span class="id" title="var">fa2_assets</span>).(<span class="id" title="var">mts_token_metadata</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">param</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">tokenAdmin</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="var">contract_simpl</span> <span class="id" title="var">fa2_receive</span> <span class="id" title="var">fa2_init</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span> <span class="id" title="var">fa2_receive</span> <span class="id" title="var">fa2_init</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">create_token</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">FMap.find</span> (<span class="id" title="var">metadata_token_id</span> <span class="id" title="var">tokenMetaData</span>) (<span class="id" title="var">mts_token_metadata</span> (<span class="id" title="var">fa2_assets</span> <span class="id" title="var">prev_state</span>))) <span class="id" title="var">eqn</span>:<span class="id" title="var">E</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">FMap.find_add_ne</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab65"></a><h2 class="section">Admin endpoint preserves total supply</h2>

</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">token_admin_endpoint_preserves_total_supply</span> {<span class="id" title="var">prev_state</span> <span class="id" title="var">next_state</span> <span class="id" title="var">acts</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">param</span> <span class="id" title="var">fa2_token_id</span> <span class="id" title="var">supply</span> <span class="id" title="var">metadata</span>} :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">FMap.find</span> <span class="id" title="var">fa2_token_id</span> <span class="id" title="var">prev_state</span>.(<span class="id" title="var">fa2_assets</span>).(<span class="id" title="var">token_total_supply</span>) = <span class="id" title="var">Some</span> <span class="id" title="var">supply</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">FMap.find</span> <span class="id" title="var">fa2_token_id</span> <span class="id" title="var">prev_state</span>.(<span class="id" title="var">fa2_assets</span>).(<span class="id" title="var">mts_token_metadata</span>) = <span class="id" title="var">Some</span> <span class="id" title="var">metadata</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">fa2_receive</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">prev_state</span> (<span class="id" title="var">Some</span> (<span class="id" title="var">Admin</span> <span class="id" title="var">param</span>)) = <span class="id" title="var">Some</span> (<span class="id" title="var">next_state</span>, <span class="id" title="var">acts</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">FMap.find</span> <span class="id" title="var">fa2_token_id</span> <span class="id" title="var">prev_state</span>.(<span class="id" title="var">fa2_assets</span>).(<span class="id" title="var">token_total_supply</span>) = <span class="id" title="var">FMap.find</span> <span class="id" title="var">fa2_token_id</span> <span class="id" title="var">next_state</span>.(<span class="id" title="var">fa2_assets</span>).(<span class="id" title="var">token_total_supply</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">param</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">tokenAdmin</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="var">contract_simpl</span> <span class="id" title="var">fa2_receive</span> <span class="id" title="var">fa2_init</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span> <span class="id" title="var">fa2_receive</span> <span class="id" title="var">fa2_init</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">create_token</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">FMap.find</span> (<span class="id" title="var">metadata_token_id</span> <span class="id" title="var">tokenMetaData</span>) (<span class="id" title="var">mts_token_metadata</span> (<span class="id" title="var">fa2_assets</span> <span class="id" title="var">prev_state</span>))) <span class="id" title="var">eqn</span>:<span class="id" title="var">E</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H2</span>; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">FMap.find_add_ne</span>; <span class="id" title="var">easy</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab66"></a><h2 class="section">Admin endpoint preserves metadata</h2>

</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">token_admin_endpoint_preserves_metadata</span> {<span class="id" title="var">prev_state</span> <span class="id" title="var">next_state</span> <span class="id" title="var">acts</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">param</span> <span class="id" title="var">fa2_token_id</span> <span class="id" title="var">supply</span> <span class="id" title="var">metadata</span>} :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">FMap.find</span> <span class="id" title="var">fa2_token_id</span> <span class="id" title="var">prev_state</span>.(<span class="id" title="var">fa2_assets</span>).(<span class="id" title="var">token_total_supply</span>) = <span class="id" title="var">Some</span> <span class="id" title="var">supply</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">FMap.find</span> <span class="id" title="var">fa2_token_id</span> <span class="id" title="var">prev_state</span>.(<span class="id" title="var">fa2_assets</span>).(<span class="id" title="var">mts_token_metadata</span>) = <span class="id" title="var">Some</span> <span class="id" title="var">metadata</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">fa2_receive</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">prev_state</span> (<span class="id" title="var">Some</span> (<span class="id" title="var">Admin</span> <span class="id" title="var">param</span>)) = <span class="id" title="var">Some</span> (<span class="id" title="var">next_state</span>, <span class="id" title="var">acts</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">FMap.find</span> <span class="id" title="var">fa2_token_id</span> <span class="id" title="var">prev_state</span>.(<span class="id" title="var">fa2_assets</span>).(<span class="id" title="var">mts_token_metadata</span>) = <span class="id" title="var">FMap.find</span> <span class="id" title="var">fa2_token_id</span> <span class="id" title="var">next_state</span>.(<span class="id" title="var">fa2_assets</span>).(<span class="id" title="var">mts_token_metadata</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">param</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">tokenAdmin</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="var">contract_simpl</span> <span class="id" title="var">fa2_receive</span> <span class="id" title="var">fa2_init</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span> <span class="id" title="var">fa2_receive</span> <span class="id" title="var">fa2_init</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">create_token</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">FMap.find</span> (<span class="id" title="var">metadata_token_id</span> <span class="id" title="var">tokenMetaData</span>) (<span class="id" title="var">mts_token_metadata</span> (<span class="id" title="var">fa2_assets</span> <span class="id" title="var">prev_state</span>))) <span class="id" title="var">eqn</span>: <span class="id" title="var">E</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H2</span>; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">FMap.find_add_ne</span>; <span class="id" title="var">easy</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab67"></a><h2 class="section">Creating a new token preserves total supply and metadata of others</h2>

</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">create_new_token_changes_nothing_else</span> {<span class="id" title="var">prev_state</span> <span class="id" title="var">next_state</span> <span class="id" title="var">acts</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">fa2_token_id</span> <span class="id" title="var">new_token_id</span> <span class="id" title="var">info_map</span>} :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">new_token_id</span> &lt;&gt; <span class="id" title="var">fa2_token_id</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">new_token_metadata</span> := {|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">metadata_token_id</span> := <span class="id" title="var">new_token_id</span> ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">metadata_token_info</span> := <span class="id" title="var">info_map</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;|} <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">fa2_receive</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">prev_state</span> (<span class="id" title="var">Some</span> (<span class="id" title="var">Admin</span> (<span class="id" title="var">Create_token</span> <span class="id" title="var">new_token_metadata</span>))) = <span class="id" title="var">Some</span> (<span class="id" title="var">next_state</span>, <span class="id" title="var">acts</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">FMap.find</span> <span class="id" title="var">fa2_token_id</span> <span class="id" title="var">prev_state</span>.(<span class="id" title="var">fa2_assets</span>).(<span class="id" title="var">token_total_supply</span>) = <span class="id" title="var">FMap.find</span> <span class="id" title="var">fa2_token_id</span> <span class="id" title="var">next_state</span>.(<span class="id" title="var">fa2_assets</span>).(<span class="id" title="var">token_total_supply</span>) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">FMap.find</span> <span class="id" title="var">fa2_token_id</span> <span class="id" title="var">prev_state</span>.(<span class="id" title="var">fa2_assets</span>).(<span class="id" title="var">mts_token_metadata</span>) = <span class="id" title="var">FMap.find</span> <span class="id" title="var">fa2_token_id</span> <span class="id" title="var">next_state</span>.(<span class="id" title="var">fa2_assets</span>).(<span class="id" title="var">mts_token_metadata</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">contract_simpl</span> <span class="id" title="var">fa2_receive</span> <span class="id" title="var">fa2_init</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">create_token</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">FMap.find</span> (<span class="id" title="var">metadata_token_id</span> <span class="id" title="var">new_token_metadata</span>) (<span class="id" title="var">mts_token_metadata</span> (<span class="id" title="var">fa2_assets</span> <span class="id" title="var">prev_state</span>))) <span class="id" title="var">eqn</span>:<span class="id" title="var">E</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">FMap.find_add_ne</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">contract_simpl</span> <span class="id" title="var">fa2_receive</span> <span class="id" title="var">fa2_init</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">create_token</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">FMap.find</span> (<span class="id" title="var">metadata_token_id</span> <span class="id" title="var">new_token_metadata</span>) (<span class="id" title="var">mts_token_metadata</span> (<span class="id" title="var">fa2_assets</span> <span class="id" title="var">prev_state</span>))) <span class="id" title="var">eqn</span>:<span class="id" title="var">E</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H1</span>. <span class="id" title="var">now</span> <span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">FMap.find_add_ne</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab68"></a><h2 class="section">Newly created token has zero total supply</h2>

</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">create_new_token_means_zero_supply</span> {<span class="id" title="var">prev_state</span> <span class="id" title="var">next_state</span> <span class="id" title="var">acts</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">fa2_token_id</span> <span class="id" title="var">info_map</span>} :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">new_token_metadata</span> := {|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">metadata_token_id</span> := <span class="id" title="var">fa2_token_id</span> ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">metadata_token_info</span> := <span class="id" title="var">info_map</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;|} <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">fa2_receive</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">prev_state</span> (<span class="id" title="var">Some</span> (<span class="id" title="var">Admin</span> (<span class="id" title="var">Create_token</span> <span class="id" title="var">new_token_metadata</span>))) = <span class="id" title="var">Some</span> (<span class="id" title="var">next_state</span>, <span class="id" title="var">acts</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">FMap.find</span> <span class="id" title="var">fa2_token_id</span> <span class="id" title="var">next_state</span>.(<span class="id" title="var">fa2_assets</span>).(<span class="id" title="var">token_total_supply</span>) = <span class="id" title="var">Some</span> 0.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="var">contract_simpl</span> <span class="id" title="var">fa2_receive</span> <span class="id" title="var">fa2_init</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">create_token</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">FMap.find</span> (<span class="id" title="var">metadata_token_id</span> <span class="id" title="var">new_token_metadata</span>) (<span class="id" title="var">mts_token_metadata</span> (<span class="id" title="var">fa2_assets</span> <span class="id" title="var">prev_state</span>))) <span class="id" title="var">eqn</span>:<span class="id" title="var">E</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">FMap.find_add</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab69"></a><h2 class="section">Set admin preserves total supply</h2>

</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">set_admin_preserves_total_supply</span> {<span class="id" title="var">prev_state</span> <span class="id" title="var">next_state</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">addr</span> <span class="id" title="var">acts</span>} :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">fa2_receive</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">prev_state</span> (<span class="id" title="var">Some</span> (<span class="id" title="var">Admin</span> (<span class="id" title="var">Token_admin</span> (<span class="id" title="var">Set_admin</span> <span class="id" title="var">addr</span>)))) = <span class="id" title="var">Some</span> (<span class="id" title="var">next_state</span>, <span class="id" title="var">acts</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">prev_state</span>.(<span class="id" title="var">fa2_assets</span>).(<span class="id" title="var">token_total_supply</span>) = <span class="id" title="var">next_state</span>.(<span class="id" title="var">fa2_assets</span>).(<span class="id" title="var">token_total_supply</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span> <span class="id" title="var">fa2_receive</span> <span class="id" title="var">fa2_init</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab70"></a><h2 class="section">Confirm admin preserves total supply</h2>

</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">confirm_admin_preserves_total_supply</span> {<span class="id" title="var">prev_state</span> <span class="id" title="var">next_state</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">acts</span>} :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">fa2_receive</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">prev_state</span> (<span class="id" title="var">Some</span> (<span class="id" title="var">Admin</span> (<span class="id" title="var">Token_admin</span> <span class="id" title="var">Confirm_admin</span>))) = <span class="id" title="var">Some</span> (<span class="id" title="var">next_state</span>, <span class="id" title="var">acts</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">prev_state</span>.(<span class="id" title="var">fa2_assets</span>).(<span class="id" title="var">token_total_supply</span>) = <span class="id" title="var">next_state</span>.(<span class="id" title="var">fa2_assets</span>).(<span class="id" title="var">token_total_supply</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span> <span class="id" title="var">fa2_receive</span> <span class="id" title="var">fa2_init</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab71"></a><h2 class="section">Pause preserves total supply</h2>

</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">pause_preserves_total_supply</span> {<span class="id" title="var">prev_state</span> <span class="id" title="var">next_state</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">acts</span> <span class="id" title="var">param</span>} :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">fa2_receive</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">prev_state</span> (<span class="id" title="var">Some</span> (<span class="id" title="var">Admin</span> (<span class="id" title="var">Token_admin</span> (<span class="id" title="var">Pause</span> <span class="id" title="var">param</span>)))) = <span class="id" title="var">Some</span> (<span class="id" title="var">next_state</span>, <span class="id" title="var">acts</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">prev_state</span>.(<span class="id" title="var">fa2_assets</span>).(<span class="id" title="var">token_total_supply</span>) = <span class="id" title="var">next_state</span>.(<span class="id" title="var">fa2_assets</span>).(<span class="id" title="var">token_total_supply</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span> <span class="id" title="var">fa2_receive</span> <span class="id" title="var">fa2_init</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab72"></a><h2 class="section">Set minter preserves total supply</h2>

</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">set_minter_preserves_total_supply</span> {<span class="id" title="var">prev_state</span> <span class="id" title="var">next_state</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">acts</span> <span class="id" title="var">addr</span>} :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">fa2_receive</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">prev_state</span> (<span class="id" title="var">Some</span> (<span class="id" title="var">Admin</span> (<span class="id" title="var">Token_admin</span> (<span class="id" title="var">Set_minter</span> <span class="id" title="var">addr</span>)))) = <span class="id" title="var">Some</span> (<span class="id" title="var">next_state</span>, <span class="id" title="var">acts</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">prev_state</span>.(<span class="id" title="var">fa2_assets</span>).(<span class="id" title="var">token_total_supply</span>) = <span class="id" title="var">next_state</span>.(<span class="id" title="var">fa2_assets</span>).(<span class="id" title="var">token_total_supply</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span> <span class="id" title="var">fa2_receive</span> <span class="id" title="var">fa2_init</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab73"></a><h2 class="section">Set admin preserves metadata</h2>

</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">set_admin_preserves_metadata</span> {<span class="id" title="var">prev_state</span> <span class="id" title="var">next_state</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">addr</span> <span class="id" title="var">acts</span>} :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">fa2_receive</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">prev_state</span> (<span class="id" title="var">Some</span> (<span class="id" title="var">Admin</span> (<span class="id" title="var">Token_admin</span> (<span class="id" title="var">Set_admin</span> <span class="id" title="var">addr</span>)))) = <span class="id" title="var">Some</span> (<span class="id" title="var">next_state</span>, <span class="id" title="var">acts</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">prev_state</span>.(<span class="id" title="var">fa2_assets</span>).(<span class="id" title="var">mts_token_metadata</span>) = <span class="id" title="var">next_state</span>.(<span class="id" title="var">fa2_assets</span>).(<span class="id" title="var">mts_token_metadata</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span> <span class="id" title="var">fa2_receive</span> <span class="id" title="var">fa2_init</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab74"></a><h2 class="section">Confirm admin preserves metadata</h2>

</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">confirm_admin_preserves_metadata</span> {<span class="id" title="var">prev_state</span> <span class="id" title="var">next_state</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">acts</span>} :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">fa2_receive</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">prev_state</span> (<span class="id" title="var">Some</span> (<span class="id" title="var">Admin</span> (<span class="id" title="var">Token_admin</span> <span class="id" title="var">Confirm_admin</span>))) = <span class="id" title="var">Some</span> (<span class="id" title="var">next_state</span>, <span class="id" title="var">acts</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">prev_state</span>.(<span class="id" title="var">fa2_assets</span>).(<span class="id" title="var">mts_token_metadata</span>) = <span class="id" title="var">next_state</span>.(<span class="id" title="var">fa2_assets</span>).(<span class="id" title="var">mts_token_metadata</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span> <span class="id" title="var">fa2_receive</span> <span class="id" title="var">fa2_init</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab75"></a><h2 class="section">Pause preserves metadata</h2>

</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">pause_preserves_metadata</span> {<span class="id" title="var">prev_state</span> <span class="id" title="var">next_state</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">acts</span> <span class="id" title="var">param</span>} :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">fa2_receive</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">prev_state</span> (<span class="id" title="var">Some</span> (<span class="id" title="var">Admin</span> (<span class="id" title="var">Token_admin</span> (<span class="id" title="var">Pause</span> <span class="id" title="var">param</span>)))) = <span class="id" title="var">Some</span> (<span class="id" title="var">next_state</span>, <span class="id" title="var">acts</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">prev_state</span>.(<span class="id" title="var">fa2_assets</span>).(<span class="id" title="var">mts_token_metadata</span>) = <span class="id" title="var">next_state</span>.(<span class="id" title="var">fa2_assets</span>).(<span class="id" title="var">mts_token_metadata</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span> <span class="id" title="var">fa2_receive</span> <span class="id" title="var">fa2_init</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab76"></a><h2 class="section">Set minter preserves metadata</h2>

</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">set_minter_preserves_metadata</span> {<span class="id" title="var">prev_state</span> <span class="id" title="var">next_state</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">acts</span> <span class="id" title="var">addr</span>} :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">fa2_receive</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">prev_state</span> (<span class="id" title="var">Some</span> (<span class="id" title="var">Admin</span> (<span class="id" title="var">Token_admin</span> (<span class="id" title="var">Set_minter</span> <span class="id" title="var">addr</span>)))) = <span class="id" title="var">Some</span> (<span class="id" title="var">next_state</span>, <span class="id" title="var">acts</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">prev_state</span>.(<span class="id" title="var">fa2_assets</span>).(<span class="id" title="var">mts_token_metadata</span>) = <span class="id" title="var">next_state</span>.(<span class="id" title="var">fa2_assets</span>).(<span class="id" title="var">mts_token_metadata</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span> <span class="id" title="var">fa2_receive</span> <span class="id" title="var">fa2_init</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab77"></a><h2 class="section">Empty mint preserves total supply</h2>

</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">empty_mint_preserves_total_supply</span> {<span class="id" title="var">prev_state</span> <span class="id" title="var">next_state</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">acts</span>} :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">fa2_receive</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">prev_state</span> (<span class="id" title="var">Some</span> (<span class="id" title="var">Tokens</span> (<span class="id" title="var">MintTokens</span> []))) = <span class="id" title="var">Some</span> (<span class="id" title="var">next_state</span>, <span class="id" title="var">acts</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">prev_state</span>.(<span class="id" title="var">fa2_assets</span>).(<span class="id" title="var">token_total_supply</span>) = <span class="id" title="var">next_state</span>.(<span class="id" title="var">fa2_assets</span>).(<span class="id" title="var">token_total_supply</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span> <span class="id" title="var">fa2_receive</span> <span class="id" title="var">fa2_init</span>. <span class="id" title="var">easy</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab78"></a><h2 class="section">Various helper lemmas</h2>

</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">burn_update_none_is_none</span> {<span class="id" title="var">txs</span>} :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">update</span> := <span class="id" title="keyword">fun</span> (<span class="id" title="var">supplies_opt</span> : <span class="id" title="var">option</span> <span class="id" title="var">TokenTotalSupply</span>) (<span class="id" title="var">tx</span>: <span class="id" title="var">MintBurnTx</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">do</span> <span class="id" title="var">supplies</span> &lt;- <span class="id" title="var">supplies_opt</span> ;    <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">do</span> <span class="id" title="var">ts</span> &lt;- <span class="id" title="var">FMap.find</span> <span class="id" title="var">tx</span>.(<span class="id" title="var">mint_burn_token_id</span>) <span class="id" title="var">supplies</span> ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">do</span> <span class="id" title="var">new_s</span> &lt;- <span class="id" title="var">sub</span> <span class="id" title="var">ts</span> <span class="id" title="var">tx</span>.(<span class="id" title="var">mint_burn_amount</span>) ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Some</span> (<span class="id" title="var">FMap.update</span> <span class="id" title="var">tx</span>.(<span class="id" title="var">mint_burn_token_id</span>) (<span class="id" title="var">Some</span> <span class="id" title="var">new_s</span>) <span class="id" title="var">supplies</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">fold_left</span> <span class="id" title="var">update</span> <span class="id" title="var">txs</span> <span class="id" title="var">None</span> = <span class="id" title="var">None</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">txs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">cbn</span>. <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">cbn</span>. <span class="id" title="var">easy</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">update_none_is_none</span> {<span class="id" title="var">txs</span>} :<br/>
<span class="id" title="keyword">let</span> <span class="id" title="var">update</span> := <span class="id" title="keyword">fun</span> (<span class="id" title="var">supplies_opt</span> : <span class="id" title="var">option</span> <span class="id" title="var">TokenTotalSupply</span>) (<span class="id" title="var">tx</span> : <span class="id" title="var">MintBurnTx</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">do</span> <span class="id" title="var">supplies</span> &lt;- <span class="id" title="var">supplies_opt</span> ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">do</span> <span class="id" title="var">ts</span> &lt;- <span class="id" title="var">FMap.find</span> <span class="id" title="var">tx</span>.(<span class="id" title="var">mint_burn_token_id</span>) <span class="id" title="var">supplies</span> ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">new_s</span> := <span class="id" title="var">ts</span> + <span class="id" title="var">tx</span>.(<span class="id" title="var">mint_burn_amount</span>) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Some</span> (<span class="id" title="var">FMap.update</span> <span class="id" title="var">tx</span>.(<span class="id" title="var">mint_burn_token_id</span>) (<span class="id" title="var">Some</span> <span class="id" title="var">new_s</span>) <span class="id" title="var">supplies</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">fold_left</span> <span class="id" title="var">update</span> <span class="id" title="var">txs</span> <span class="id" title="var">None</span> = <span class="id" title="var">None</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">txs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">cbn</span>. <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">cbn</span>. <span class="id" title="var">easy</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">update_app</span> {<span class="id" title="var">txs</span> <span class="id" title="var">ts</span> <span class="id" title="var">a</span>} :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">update</span> := <span class="id" title="keyword">fun</span> (<span class="id" title="var">supplies_opt</span> : <span class="id" title="var">option</span> <span class="id" title="var">TokenTotalSupply</span>) (<span class="id" title="var">tx</span> : <span class="id" title="var">MintBurnTx</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">do</span> <span class="id" title="var">supplies</span> &lt;- <span class="id" title="var">supplies_opt</span> ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">do</span> <span class="id" title="var">ts</span> &lt;- <span class="id" title="var">FMap.find</span> <span class="id" title="var">tx</span>.(<span class="id" title="var">mint_burn_token_id</span>) <span class="id" title="var">supplies</span> ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">new_s</span> := <span class="id" title="var">ts</span> + <span class="id" title="var">tx</span>.(<span class="id" title="var">mint_burn_amount</span>) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Some</span> (<span class="id" title="var">FMap.update</span> <span class="id" title="var">tx</span>.(<span class="id" title="var">mint_burn_token_id</span>) (<span class="id" title="var">Some</span> <span class="id" title="var">new_s</span>) <span class="id" title="var">supplies</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">fold_left</span> <span class="id" title="var">update</span> (<span class="id" title="var">a</span> :: <span class="id" title="var">txs</span>) <span class="id" title="var">ts</span> =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">fold_left</span> <span class="id" title="var">update</span> <span class="id" title="var">txs</span> (<span class="id" title="var">update</span> <span class="id" title="var">ts</span> <span class="id" title="var">a</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> *. <span class="id" title="tactic">induction</span> <span class="id" title="var">txs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">cbn</span>. <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">destruct</span> <span class="id" title="var">ts</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">update_app2</span> : <span class="id" title="keyword">forall</span> (<span class="id" title="var">update</span> : <span class="id" title="var">option</span> <span class="id" title="var">TokenTotalSupply</span> -&gt; <span class="id" title="var">MintBurnTx</span> -&gt; <span class="id" title="var">option</span> <span class="id" title="var">TokenTotalSupply</span>) <span class="id" title="var">txs</span> <span class="id" title="var">ts</span> <span class="id" title="var">a</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">fold_left</span> <span class="id" title="var">update</span> (<span class="id" title="var">a</span> :: <span class="id" title="var">txs</span>) <span class="id" title="var">ts</span> =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">fold_left</span> <span class="id" title="var">update</span> <span class="id" title="var">txs</span> (<span class="id" title="var">update</span> <span class="id" title="var">ts</span> <span class="id" title="var">a</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> *. <span class="id" title="tactic">induction</span> <span class="id" title="var">txs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">cbn</span>. <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">destruct</span> <span class="id" title="var">ts</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">update_comm</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">txs</span> <span class="id" title="var">t</span> <span class="id" title="var">a1</span> <span class="id" title="var">a2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">update</span> := <span class="id" title="keyword">fun</span> (<span class="id" title="var">supplies_opt</span> : <span class="id" title="var">option</span> <span class="id" title="var">TokenTotalSupply</span>) (<span class="id" title="var">tx</span> : <span class="id" title="var">MintBurnTx</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">do</span> <span class="id" title="var">supplies</span> &lt;- <span class="id" title="var">supplies_opt</span> ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">do</span> <span class="id" title="var">ts</span> &lt;- <span class="id" title="var">FMap.find</span> <span class="id" title="var">tx</span>.(<span class="id" title="var">mint_burn_token_id</span>) <span class="id" title="var">supplies</span> ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">new_s</span> := <span class="id" title="var">ts</span> + <span class="id" title="var">tx</span>.(<span class="id" title="var">mint_burn_amount</span>) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Some</span> (<span class="id" title="var">FMap.update</span> <span class="id" title="var">tx</span>.(<span class="id" title="var">mint_burn_token_id</span>) (<span class="id" title="var">Some</span> <span class="id" title="var">new_s</span>) <span class="id" title="var">supplies</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">fold_left</span> <span class="id" title="var">update</span> <span class="id" title="var">txs</span> (<span class="id" title="var">update</span> (<span class="id" title="var">update</span> <span class="id" title="var">t</span> <span class="id" title="var">a1</span>) <span class="id" title="var">a2</span>) =<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">fold_left</span> <span class="id" title="var">update</span> <span class="id" title="var">txs</span> (<span class="id" title="var">update</span> (<span class="id" title="var">update</span> <span class="id" title="var">t</span> <span class="id" title="var">a2</span>) <span class="id" title="var">a1</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">t</span> <span class="id" title="var">eqn</span>:<span class="id" title="var">T</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>. <span class="id" title="tactic">rename</span> <span class="id" title="var">t0</span> <span class="id" title="var">into</span> <span class="id" title="var">ts</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> &lt;- (<span class="id" title="var">update_app2</span> <span class="id" title="var">update</span> [] (<span class="id" title="var">update</span> (<span class="id" title="var">Some</span> <span class="id" title="var">ts</span>) <span class="id" title="var">a1</span>) <span class="id" title="var">a2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> &lt;- (<span class="id" title="var">update_app2</span> <span class="id" title="var">update</span> [<span class="id" title="var">a2</span>] (<span class="id" title="var">Some</span> <span class="id" title="var">ts</span>) <span class="id" title="var">a1</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> &lt;- (<span class="id" title="var">update_app2</span> <span class="id" title="var">update</span> [] (<span class="id" title="var">update</span> (<span class="id" title="var">Some</span> <span class="id" title="var">ts</span>) <span class="id" title="var">a2</span>) <span class="id" title="var">a1</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> &lt;- (<span class="id" title="var">update_app2</span> <span class="id" title="var">update</span> [<span class="id" title="var">a1</span>] (<span class="id" title="var">Some</span> <span class="id" title="var">ts</span>) <span class="id" title="var">a2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">FMap.find</span> (<span class="id" title="var">mint_burn_token_id</span> <span class="id" title="var">a1</span>)) <span class="id" title="var">eqn</span>:<span class="id" title="var">E</span>; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">FMap.find</span> (<span class="id" title="var">mint_burn_token_id</span> <span class="id" title="var">a2</span>)) <span class="id" title="var">eqn</span>:<span class="id" title="var">E2</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">mint_burn_token_id</span> <span class="id" title="var">a1</span> =? <span class="id" title="var">mint_burn_token_id</span> <span class="id" title="var">a2</span>) <span class="id" title="var">eqn</span>:<span class="id" title="var">E3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">N.eqb_eq</span> <span class="id" title="tactic">in</span> <span class="id" title="var">E3</span>. <span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">E3</span>. <span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">E3</span> <span class="id" title="tactic">in</span> <span class="id" title="var">E</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">E3</span> <span class="id" title="tactic">in</span> <span class="id" title="var">E2</span>. <span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">FMap.find_add</span> <span class="id" title="tactic">in</span> <span class="id" title="var">E2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">E2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">E</span>. <span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">E3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">FMap.find_add</span>. <span class="id" title="tactic">f_equal</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">E3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">FMap.add_add</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">N.eqb_neq</span> <span class="id" title="tactic">in</span> <span class="id" title="var">E3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">FMap.find_add_ne</span> <span class="id" title="tactic">in</span> <span class="id" title="var">E2</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">E2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">FMap.find_add_ne</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">E</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">f_equal</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">FMap.add_commute</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">N.eqb_eq</span> <span class="id" title="tactic">in</span> <span class="id" title="var">E3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">E3</span> <span class="id" title="tactic">in</span> <span class="id" title="var">E</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">E3</span> <span class="id" title="tactic">in</span> <span class="id" title="var">E2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">FMap.find_add</span> <span class="id" title="tactic">in</span> <span class="id" title="var">E2</span>. <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">N.eqb_neq</span> <span class="id" title="tactic">in</span> <span class="id" title="var">E3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">FMap.find_add_ne</span> <span class="id" title="tactic">in</span> <span class="id" title="var">E2</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">E2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">N.eqb_eq</span> <span class="id" title="tactic">in</span> <span class="id" title="var">E3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">E3</span> <span class="id" title="tactic">in</span> <span class="id" title="var">E</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">E</span> <span class="id" title="tactic">in</span> <span class="id" title="var">E2</span>. <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">N.eqb_neq</span> <span class="id" title="tactic">in</span> <span class="id" title="var">E3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">FMap.find_add_ne</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">E</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="var">easy</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">update_app_not_none</span> {<span class="id" title="var">a</span> <span class="id" title="var">txs</span> <span class="id" title="var">ts</span>} :<br/>
<span class="id" title="keyword">let</span> <span class="id" title="var">update</span> := <span class="id" title="keyword">fun</span> (<span class="id" title="var">supplies_opt</span> : <span class="id" title="var">option</span> <span class="id" title="var">TokenTotalSupply</span>) (<span class="id" title="var">tx</span> : <span class="id" title="var">MintBurnTx</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">do</span> <span class="id" title="var">supplies</span> &lt;- <span class="id" title="var">supplies_opt</span> ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">do</span> <span class="id" title="var">ts</span> &lt;- <span class="id" title="var">FMap.find</span> <span class="id" title="var">tx</span>.(<span class="id" title="var">mint_burn_token_id</span>) <span class="id" title="var">supplies</span> ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">new_s</span> := <span class="id" title="var">ts</span> + <span class="id" title="var">tx</span>.(<span class="id" title="var">mint_burn_amount</span>) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Some</span> (<span class="id" title="var">FMap.update</span> <span class="id" title="var">tx</span>.(<span class="id" title="var">mint_burn_token_id</span>) (<span class="id" title="var">Some</span> <span class="id" title="var">new_s</span>) <span class="id" title="var">supplies</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">fold_left</span> <span class="id" title="var">update</span> (<span class="id" title="var">a</span> :: <span class="id" title="var">txs</span>) <span class="id" title="var">ts</span> &lt;&gt; <span class="id" title="var">None</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">fold_left</span> <span class="id" title="var">update</span> (<span class="id" title="var">txs</span>) <span class="id" title="var">ts</span> &lt;&gt; <span class="id" title="var">None</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">ts</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">txs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">ts</span>) <span class="id" title="var">eqn</span>:<span class="id" title="var">E</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">update_app2</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">update_app2</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">update</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">update_comm</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">update_app</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IHtxs</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">update_app</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">easy</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab79"></a><h2 class="section">Mint preserves metadata</h2>

</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">mint_preserves_metadata</span> {<span class="id" title="var">prev_state</span> <span class="id" title="var">next_state</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">acts</span> <span class="id" title="var">p</span>} :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">fa2_receive</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">prev_state</span> (<span class="id" title="var">Some</span> (<span class="id" title="var">Tokens</span> (<span class="id" title="var">MintTokens</span> <span class="id" title="var">p</span>))) = <span class="id" title="var">Some</span> (<span class="id" title="var">next_state</span>, <span class="id" title="var">acts</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">prev_state</span>.(<span class="id" title="var">fa2_assets</span>).(<span class="id" title="var">mts_token_metadata</span>) = <span class="id" title="var">next_state</span>.(<span class="id" title="var">fa2_assets</span>).(<span class="id" title="var">mts_token_metadata</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="var">contract_simpl</span> <span class="id" title="var">fa2_receive</span> <span class="id" title="var">fa2_init</span>. <span class="id" title="var">easy</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab80"></a><h2 class="section">Burn preserves metadata</h2>

</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">burn_preserves_metadata</span> {<span class="id" title="var">prev_state</span> <span class="id" title="var">next_state</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">acts</span> <span class="id" title="var">p</span>} :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">fa2_receive</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">prev_state</span> (<span class="id" title="var">Some</span> (<span class="id" title="var">Tokens</span> (<span class="id" title="var">BurnTokens</span> <span class="id" title="var">p</span>))) = <span class="id" title="var">Some</span> (<span class="id" title="var">next_state</span>, <span class="id" title="var">acts</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">prev_state</span>.(<span class="id" title="var">fa2_assets</span>).(<span class="id" title="var">mts_token_metadata</span>) = <span class="id" title="var">next_state</span>.(<span class="id" title="var">fa2_assets</span>).(<span class="id" title="var">mts_token_metadata</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="var">contract_simpl</span> <span class="id" title="var">fa2_receive</span> <span class="id" title="var">fa2_init</span>. <span class="id" title="var">easy</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab81"></a><h2 class="section">Set admin does not change minter</h2>

</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">set_admin_does_not_change_minter</span> {<span class="id" title="var">prev_state</span> <span class="id" title="var">next_state</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">addr</span> <span class="id" title="var">acts</span>} :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">fa2_receive</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">prev_state</span> (<span class="id" title="var">Some</span> (<span class="id" title="var">Admin</span> (<span class="id" title="var">Token_admin</span> (<span class="id" title="var">Set_admin</span> <span class="id" title="var">addr</span>)))) = <span class="id" title="var">Some</span> (<span class="id" title="var">next_state</span>, <span class="id" title="var">acts</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">prev_state</span>.(<span class="id" title="var">fa2_admin</span>).(<span class="id" title="var">tas_minter</span>) = <span class="id" title="var">next_state</span>.(<span class="id" title="var">fa2_admin</span>).(<span class="id" title="var">tas_minter</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="var">contract_simpl</span> <span class="id" title="var">fa2_receive</span> <span class="id" title="var">fa2_init</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">set_admin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cbn</span>. <span class="id" title="tactic">unfold</span> <span class="id" title="var">fail_if_not_admin</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>. <span class="id" title="var">destruct_address_eq</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab82"></a><h2 class="section">Confirm admin does not change minter</h2>

</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">confirm_admin_does_not_change_minter</span> {<span class="id" title="var">prev_state</span> <span class="id" title="var">next_state</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">acts</span>} :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">fa2_receive</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">prev_state</span> (<span class="id" title="var">Some</span> (<span class="id" title="var">Admin</span> (<span class="id" title="var">Token_admin</span> <span class="id" title="var">Confirm_admin</span>))) = <span class="id" title="var">Some</span> (<span class="id" title="var">next_state</span>, <span class="id" title="var">acts</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">prev_state</span>.(<span class="id" title="var">fa2_admin</span>).(<span class="id" title="var">tas_minter</span>) = <span class="id" title="var">next_state</span>.(<span class="id" title="var">fa2_admin</span>).(<span class="id" title="var">tas_minter</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="var">contract_simpl</span> <span class="id" title="var">fa2_receive</span> <span class="id" title="var">fa2_init</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">confirm_new_admin</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">destruct</span> (<span class="id" title="var">tas_pending_admin</span> (<span class="id" title="var">fa2_admin</span> <span class="id" title="var">prev_state</span>)) <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">destruct_address_eq</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>; <span class="id" title="var">now</span> <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab83"></a><h2 class="section">Pause does not change minter</h2>

</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">pause_does_not_change_minter</span> {<span class="id" title="var">prev_state</span> <span class="id" title="var">next_state</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">param</span> <span class="id" title="var">acts</span>} :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">fa2_receive</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">prev_state</span> (<span class="id" title="var">Some</span> (<span class="id" title="var">Admin</span> (<span class="id" title="var">Token_admin</span> (<span class="id" title="var">Pause</span> <span class="id" title="var">param</span>)))) = <span class="id" title="var">Some</span> (<span class="id" title="var">next_state</span>, <span class="id" title="var">acts</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">prev_state</span>.(<span class="id" title="var">fa2_admin</span>).(<span class="id" title="var">tas_minter</span>) = <span class="id" title="var">next_state</span>.(<span class="id" title="var">fa2_admin</span>).(<span class="id" title="var">tas_minter</span>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="var">contract_simpl</span> <span class="id" title="var">fa2_receive</span> <span class="id" title="var">fa2_init</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">fail_if_not_admin</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">destruct_address_eq</span>; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>; <span class="id" title="var">now</span> <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab84"></a><h2 class="section">If no metadata exists for token, then no supply exists</h2>

</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">no_metadata_no_supply</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">bstate</span> <span class="id" title="var">caddr</span> <span class="id" title="var">fa2_token_id</span> (<span class="id" title="var">trace</span>: <span class="id" title="var">ChainTrace</span> <span class="id" title="var">empty_state</span> <span class="id" title="var">bstate</span>),<br/>
<span class="id" title="var">env_contracts</span> <span class="id" title="var">bstate</span> <span class="id" title="var">caddr</span> = <span class="id" title="var">Some</span> (<span class="id" title="var">FA2_contract</span> : <span class="id" title="var">WeakContract</span>) -&gt;<br/>
<span class="id" title="tactic">exists</span> <span class="id" title="var">cstate</span> ,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contract_state</span> <span class="id" title="var">bstate</span> <span class="id" title="var">caddr</span> = <span class="id" title="var">Some</span> <span class="id" title="var">cstate</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">FMap.find</span> <span class="id" title="var">fa2_token_id</span> <span class="id" title="var">cstate</span>.(<span class="id" title="var">fa2_assets</span>).(<span class="id" title="var">mts_token_metadata</span>) = <span class="id" title="var">None</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">FMap.find</span> <span class="id" title="var">fa2_token_id</span> <span class="id" title="var">cstate</span>.(<span class="id" title="var">fa2_assets</span>).(<span class="id" title="var">token_total_supply</span>) = <span class="id" title="var">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contract_induction</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">init</span> <span class="id" title="tactic">in</span> <span class="id" title="var">init_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> *. <span class="id" title="tactic">unfold</span> <span class="id" title="var">fa2_init</span> <span class="id" title="tactic">in</span> <span class="id" title="var">init_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">init_some</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>. <span class="id" title="tactic">subst</span>. <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">induction</span> (<span class="id" title="var">tokens</span> <span class="id" title="var">setup</span>); <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> *. <span class="id" title="tactic">destruct</span> (<span class="id" title="var">metadata_token_id</span> <span class="id" title="var">a</span> =? <span class="id" title="var">fa2_token_id</span>) <span class="id" title="var">eqn</span>: <span class="id" title="var">E</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">apply</span> <span class="id" title="var">N.eqb_eq</span> <span class="id" title="tactic">in</span> <span class="id" title="var">E</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span>. <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">FMap.find_add</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>. <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">apply</span> <span class="id" title="var">N.eqb_neq</span> <span class="id" title="tactic">in</span> <span class="id" title="var">E</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">FMap.find_add_ne</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">IHl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">FMap.find_add_ne</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">receive</span> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> *. <span class="id" title="tactic">destruct</span> <span class="id" title="var">msg</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">m</span>; <span class="id" title="tactic">destruct</span> <span class="id" title="var">param</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">erewrite</span> &lt;- <span class="id" title="var">assets_endpoint_preserves_metadata</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IH</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">erewrite</span> &lt;- <span class="id" title="var">assets_endpoint_preserves_total_supply</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">erewrite</span> &lt;- <span class="id" title="var">assets_endpoint_preserves_metadata</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IH</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">erewrite</span> &lt;- <span class="id" title="var">assets_endpoint_preserves_total_supply</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">erewrite</span> &lt;- <span class="id" title="var">assets_endpoint_preserves_metadata</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IH</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>. <span class="id" title="var">erewrite</span> &lt;- <span class="id" title="var">assets_endpoint_preserves_total_supply</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">destruct</span> <span class="id" title="var">tokenAdmin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id" title="var">erewrite</span> &lt;- <span class="id" title="var">set_admin_preserves_metadata</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">erewrite</span> &lt;- <span class="id" title="var">set_admin_preserves_total_supply</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id" title="var">erewrite</span> &lt;- <span class="id" title="var">confirm_admin_preserves_metadata</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">erewrite</span> &lt;- <span class="id" title="var">confirm_admin_preserves_total_supply</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id" title="var">erewrite</span> &lt;- <span class="id" title="var">pause_preserves_metadata</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">erewrite</span> &lt;- <span class="id" title="var">pause_preserves_total_supply</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id" title="var">erewrite</span> &lt;- <span class="id" title="var">set_minter_preserves_metadata</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">erewrite</span> &lt;- <span class="id" title="var">set_minter_preserves_total_supply</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">destruct</span> <span class="id" title="var">tokenMetaData</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">metadata_token_id</span> =? <span class="id" title="var">fa2_token_id</span>) <span class="id" title="var">eqn</span>: <span class="id" title="var">E</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id" title="tactic">apply</span> <span class="id" title="var">N.eqb_eq</span> <span class="id" title="tactic">in</span> <span class="id" title="var">E</span>. <span class="id" title="tactic">subst</span>. <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">create_token</span> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span>. <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">FMap.find</span> <span class="id" title="var">fa2_token_id</span> (<span class="id" title="var">mts_token_metadata</span> (<span class="id" title="var">fa2_assets</span> <span class="id" title="var">prev_state</span>))) <span class="id" title="var">eqn</span>: <span class="id" title="var">E1</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">receive_some</span>. <span class="id" title="tactic">subst</span>. <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> *. <span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">FMap.find_add</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>. <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id" title="tactic">rewrite</span> <span class="id" title="var">N.eqb_neq</span> <span class="id" title="tactic">in</span> <span class="id" title="var">E</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">create_new_token_changes_nothing_else</span> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">receive_some</span>. <span class="id" title="tactic">setoid_rewrite</span> &lt;- <span class="id" title="var">H1</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">IH</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>. <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">erewrite</span> &lt;- <span class="id" title="var">mint_preserves_metadata</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eauto</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">IH</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>. <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">fail_if_not_minter</span> <span class="id" title="var">ctx</span> (<span class="id" title="var">fa2_admin</span> <span class="id" title="var">prev_state</span>)); <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> (<span class="id" title="var">token_total_supply</span> (<span class="id" title="var">fa2_assets</span> <span class="id" title="var">prev_state</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> (<span class="id" title="var">ledger</span> (<span class="id" title="var">fa2_assets</span> <span class="id" title="var">prev_state</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">mint_update_total_supply</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">p</span>; <span class="id" title="tactic">intros</span>; <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> *; <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id" title="tactic">inversion</span> <span class="id" title="var">receive_some</span>. <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> *. <span class="id" title="tactic">destruct</span> (<span class="id" title="var">mint_burn_token_id</span> <span class="id" title="var">a</span> =? <span class="id" title="var">fa2_token_id</span>) <span class="id" title="var">eqn</span>: <span class="id" title="var">E2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id" title="tactic">apply</span> <span class="id" title="var">N.eqb_eq</span> <span class="id" title="tactic">in</span> <span class="id" title="var">E2</span>. <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">H</span> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">update_none_is_none</span> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span>. <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id" title="tactic">destruct</span> (<span class="id" title="var">FMap.find</span> (<span class="id" title="var">mint_burn_token_id</span> <span class="id" title="var">a</span>) <span class="id" title="var">t0</span>) <span class="id" title="var">eqn</span>: <span class="id" title="var">E3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--- <span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">E3</span> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> &lt;- (<span class="id" title="var">FMap.find_add_ne</span> (<span class="id" title="var">mint_burn_token_id</span> <span class="id" title="var">a</span>) <span class="id" title="var">_</span> (<span class="id" title="var">n</span>+ <span class="id" title="var">mint_burn_amount</span> <span class="id" title="var">a</span>) <span class="id" title="var">_</span>) <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>; <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--- <span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">E3</span> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">update_none_is_none</span> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span>. <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">erewrite</span> &lt;- <span class="id" title="var">burn_preserves_metadata</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IH</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>. <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">fail_if_not_minter</span> <span class="id" title="var">ctx</span> (<span class="id" title="var">fa2_admin</span> <span class="id" title="var">prev_state</span>)); <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">burn_update_balances</span> <span class="id" title="var">p</span> (<span class="id" title="var">ledger</span> (<span class="id" title="var">fa2_assets</span> <span class="id" title="var">prev_state</span>))); <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> (<span class="id" title="var">token_total_supply</span> (<span class="id" title="var">fa2_assets</span> <span class="id" title="var">prev_state</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> (<span class="id" title="var">ledger</span> (<span class="id" title="var">fa2_assets</span> <span class="id" title="var">prev_state</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">burn_update_total_supply</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">p</span>; <span class="id" title="tactic">intros</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id" title="tactic">inversion</span> <span class="id" title="var">receive_some</span>. <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id" title="tactic">destruct</span> (<span class="id" title="var">mint_burn_token_id</span> <span class="id" title="var">a</span> =? <span class="id" title="var">fa2_token_id</span>) <span class="id" title="var">eqn</span>: <span class="id" title="var">E2</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">burn_update_balances</span> (<span class="id" title="var">a</span> :: <span class="id" title="var">p</span>) <span class="id" title="var">l</span>); <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>; <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id" title="tactic">apply</span> <span class="id" title="var">N.eqb_eq</span> <span class="id" title="tactic">in</span> <span class="id" title="var">E2</span>. <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">H0</span> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span>. <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">burn_update_none_is_none</span> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span>. <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id" title="tactic">apply</span> <span class="id" title="var">N.eqb_eq</span> <span class="id" title="tactic">in</span> <span class="id" title="var">E2</span>. <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">H0</span> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span>. <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">burn_update_none_is_none</span> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span>. <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id" title="tactic">destruct</span> (<span class="id" title="var">FMap.find</span> (<span class="id" title="var">mint_burn_token_id</span> <span class="id" title="var">a</span>) <span class="id" title="var">t0</span>) <span class="id" title="var">eqn</span>: <span class="id" title="var">E3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--- <span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">E3</span> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">n</span> &lt;? <span class="id" title="var">mint_burn_amount</span> <span class="id" title="var">a</span>) <span class="id" title="var">eqn</span>: <span class="id" title="var">E4</span>; <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;---- <span class="id" title="tactic">rewrite</span> <span class="id" title="var">burn_update_none_is_none</span> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span>. <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;---- <span class="id" title="tactic">setoid_rewrite</span> &lt;- (<span class="id" title="var">FMap.find_add_ne</span> (<span class="id" title="var">mint_burn_token_id</span> <span class="id" title="var">a</span>) <span class="id" title="var">_</span> (<span class="id" title="var">n</span> - <span class="id" title="var">mint_burn_amount</span> <span class="id" title="var">a</span>) <span class="id" title="var">_</span>) <span class="id" title="tactic">in</span> <span class="id" title="var">H0</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--- <span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">E3</span> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">burn_update_none_is_none</span> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span>. <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id" title="tactic">destruct</span> (<span class="id" title="var">FMap.find</span> (<span class="id" title="var">mint_burn_token_id</span> <span class="id" title="var">a</span>) <span class="id" title="var">t0</span>) <span class="id" title="var">eqn</span>: <span class="id" title="var">E3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--- <span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">E3</span> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span>. <span class="id" title="tactic">destruct</span> (<span class="id" title="var">n</span> &lt;? <span class="id" title="var">mint_burn_amount</span> <span class="id" title="var">a</span>) <span class="id" title="var">eqn</span>: <span class="id" title="var">E4</span>; <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;---- <span class="id" title="tactic">rewrite</span> <span class="id" title="var">burn_update_none_is_none</span> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span>. <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;---- <span class="id" title="tactic">setoid_rewrite</span> &lt;- (<span class="id" title="var">FMap.find_add_ne</span> (<span class="id" title="var">mint_burn_token_id</span> <span class="id" title="var">a</span>) <span class="id" title="var">_</span> (<span class="id" title="var">n</span> - <span class="id" title="var">mint_burn_amount</span> <span class="id" title="var">a</span>) <span class="id" title="var">_</span>) <span class="id" title="tactic">in</span> <span class="id" title="var">H0</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--- <span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">E3</span> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">burn_update_none_is_none</span> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span>. <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">msg</span> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">m</span>; <span class="id" title="tactic">destruct</span> <span class="id" title="var">param</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">erewrite</span> &lt;- <span class="id" title="var">assets_endpoint_preserves_metadata</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IH</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">erewrite</span> &lt;- <span class="id" title="var">assets_endpoint_preserves_total_supply</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">erewrite</span> &lt;- <span class="id" title="var">assets_endpoint_preserves_metadata</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IH</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">erewrite</span> &lt;- <span class="id" title="var">assets_endpoint_preserves_total_supply</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">erewrite</span> &lt;- <span class="id" title="var">assets_endpoint_preserves_metadata</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IH</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>. <span class="id" title="var">erewrite</span> &lt;- <span class="id" title="var">assets_endpoint_preserves_total_supply</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">destruct</span> <span class="id" title="var">tokenAdmin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id" title="var">erewrite</span> &lt;- <span class="id" title="var">set_admin_preserves_metadata</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">erewrite</span> &lt;- <span class="id" title="var">set_admin_preserves_total_supply</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id" title="var">erewrite</span> &lt;- <span class="id" title="var">confirm_admin_preserves_metadata</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">erewrite</span> &lt;- <span class="id" title="var">confirm_admin_preserves_total_supply</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id" title="var">erewrite</span> &lt;- <span class="id" title="var">pause_preserves_metadata</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">erewrite</span> &lt;- <span class="id" title="var">pause_preserves_total_supply</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id" title="var">erewrite</span> &lt;- <span class="id" title="var">set_minter_preserves_metadata</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">erewrite</span> &lt;- <span class="id" title="var">set_minter_preserves_total_supply</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">destruct</span> <span class="id" title="var">tokenMetaData</span>. <span class="id" title="tactic">destruct</span> (<span class="id" title="var">metadata_token_id</span> =? <span class="id" title="var">fa2_token_id</span>) <span class="id" title="var">eqn</span>: <span class="id" title="var">E</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id" title="tactic">apply</span> <span class="id" title="var">N.eqb_eq</span> <span class="id" title="tactic">in</span> <span class="id" title="var">E</span>. <span class="id" title="tactic">subst</span>. <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">create_token</span> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span>. <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">FMap.find</span> <span class="id" title="var">fa2_token_id</span> (<span class="id" title="var">mts_token_metadata</span> (<span class="id" title="var">fa2_assets</span> <span class="id" title="var">prev_state</span>))) <span class="id" title="var">eqn</span>: <span class="id" title="var">E1</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">receive_some</span>. <span class="id" title="tactic">subst</span>. <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">FMap.find_add</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>. <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id" title="tactic">rewrite</span> <span class="id" title="var">N.eqb_neq</span> <span class="id" title="tactic">in</span> <span class="id" title="var">E</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">create_new_token_changes_nothing_else</span> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> &lt;- <span class="id" title="var">H1</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">IH</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>. <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">erewrite</span> &lt;- <span class="id" title="var">mint_preserves_metadata</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IH</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>. <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">fail_if_not_minter</span> <span class="id" title="var">ctx</span> (<span class="id" title="var">fa2_admin</span> <span class="id" title="var">prev_state</span>)); <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> (<span class="id" title="var">token_total_supply</span> (<span class="id" title="var">fa2_assets</span> <span class="id" title="var">prev_state</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> (<span class="id" title="var">ledger</span> (<span class="id" title="var">fa2_assets</span> <span class="id" title="var">prev_state</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">mint_update_total_supply</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">p</span>; <span class="id" title="tactic">intros</span>; <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> *; <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id" title="tactic">inversion</span> <span class="id" title="var">receive_some</span>. <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">mint_burn_token_id</span> <span class="id" title="var">a</span> =? <span class="id" title="var">fa2_token_id</span>) <span class="id" title="var">eqn</span>: <span class="id" title="var">E2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id" title="tactic">apply</span> <span class="id" title="var">N.eqb_eq</span> <span class="id" title="tactic">in</span> <span class="id" title="var">E2</span>. <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">H</span> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">update_none_is_none</span> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span>. <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id" title="tactic">destruct</span> (<span class="id" title="var">FMap.find</span> (<span class="id" title="var">mint_burn_token_id</span> <span class="id" title="var">a</span>) <span class="id" title="var">t0</span>) <span class="id" title="var">eqn</span>: <span class="id" title="var">E3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--- <span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">E3</span> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> &lt;- (<span class="id" title="var">FMap.find_add_ne</span> (<span class="id" title="var">mint_burn_token_id</span> <span class="id" title="var">a</span>) <span class="id" title="var">_</span> (<span class="id" title="var">n</span>+ <span class="id" title="var">mint_burn_amount</span> <span class="id" title="var">a</span>) <span class="id" title="var">_</span>) <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;---- <span class="id" title="tactic">eapply</span> <span class="id" title="var">IHp</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;---- <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--- <span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">E3</span> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">update_none_is_none</span> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span>. <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">erewrite</span> &lt;- <span class="id" title="var">burn_preserves_metadata</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eauto</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">IH</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>. <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">fail_if_not_minter</span> <span class="id" title="var">ctx</span> (<span class="id" title="var">fa2_admin</span> <span class="id" title="var">prev_state</span>)); <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">burn_update_balances</span> <span class="id" title="var">p</span> (<span class="id" title="var">ledger</span> (<span class="id" title="var">fa2_assets</span> <span class="id" title="var">prev_state</span>))); <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> (<span class="id" title="var">token_total_supply</span> (<span class="id" title="var">fa2_assets</span> <span class="id" title="var">prev_state</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> (<span class="id" title="var">ledger</span> (<span class="id" title="var">fa2_assets</span> <span class="id" title="var">prev_state</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">burn_update_total_supply</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">p</span>; <span class="id" title="tactic">intros</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id" title="tactic">inversion</span> <span class="id" title="var">receive_some</span>. <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id" title="tactic">destruct</span> (<span class="id" title="var">mint_burn_token_id</span> <span class="id" title="var">a</span> =? <span class="id" title="var">fa2_token_id</span>) <span class="id" title="var">eqn</span>: <span class="id" title="var">E2</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">burn_update_balances</span> (<span class="id" title="var">a</span> :: <span class="id" title="var">p</span>) <span class="id" title="var">l</span>); <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>; <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id" title="tactic">apply</span> <span class="id" title="var">N.eqb_eq</span> <span class="id" title="tactic">in</span> <span class="id" title="var">E2</span>. <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">H0</span> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span>. <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">burn_update_none_is_none</span> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span>. <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id" title="tactic">destruct</span> (<span class="id" title="var">FMap.find</span> (<span class="id" title="var">mint_burn_token_id</span> <span class="id" title="var">a</span>) <span class="id" title="var">t0</span>) <span class="id" title="var">eqn</span>: <span class="id" title="var">E3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--- <span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">E3</span> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">n</span> &lt;? <span class="id" title="var">mint_burn_amount</span> <span class="id" title="var">a</span>) <span class="id" title="var">eqn</span>: <span class="id" title="var">E4</span>; <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;---- <span class="id" title="tactic">rewrite</span> <span class="id" title="var">burn_update_none_is_none</span> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span>. <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;---- <span class="id" title="tactic">apply</span> <span class="id" title="var">N.eqb_eq</span> <span class="id" title="tactic">in</span> <span class="id" title="var">E2</span>. <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H0</span> <span class="id" title="tactic">in</span> <span class="id" title="var">E3</span>. <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--- <span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">E3</span> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">burn_update_none_is_none</span> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span>. <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id" title="tactic">destruct</span> (<span class="id" title="var">FMap.find</span> (<span class="id" title="var">mint_burn_token_id</span> <span class="id" title="var">a</span>) <span class="id" title="var">t0</span>) <span class="id" title="var">eqn</span>: <span class="id" title="var">E3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--- <span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">E3</span> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">n</span> &lt;? <span class="id" title="var">mint_burn_amount</span> <span class="id" title="var">a</span>) <span class="id" title="var">eqn</span>: <span class="id" title="var">E4</span>; <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;---- <span class="id" title="tactic">rewrite</span> <span class="id" title="var">burn_update_none_is_none</span> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span>. <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;---- <span class="id" title="tactic">setoid_rewrite</span> &lt;- (<span class="id" title="var">FMap.find_add_ne</span> (<span class="id" title="var">mint_burn_token_id</span> <span class="id" title="var">a</span>) <span class="id" title="var">_</span> (<span class="id" title="var">n</span> - <span class="id" title="var">mint_burn_amount</span> <span class="id" title="var">a</span>) <span class="id" title="var">_</span>) <span class="id" title="tactic">in</span> <span class="id" title="var">H0</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--- <span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">E3</span> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">burn_update_none_is_none</span> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span>. <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id" title="tactic">destruct</span> (<span class="id" title="var">FMap.find</span> (<span class="id" title="var">mint_burn_token_id</span> <span class="id" title="var">a</span>) <span class="id" title="var">t0</span>) <span class="id" title="var">eqn</span>: <span class="id" title="var">E3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--- <span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">E3</span> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">n</span> &lt;? <span class="id" title="var">mint_burn_amount</span> <span class="id" title="var">a</span>) <span class="id" title="var">eqn</span>: <span class="id" title="var">E4</span>; <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;---- <span class="id" title="tactic">rewrite</span> <span class="id" title="var">burn_update_none_is_none</span> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span>. <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;---- <span class="id" title="tactic">setoid_rewrite</span> &lt;- (<span class="id" title="var">FMap.find_add_ne</span> (<span class="id" title="var">mint_burn_token_id</span> <span class="id" title="var">a</span>) <span class="id" title="var">_</span> (<span class="id" title="var">n</span> - <span class="id" title="var">mint_burn_amount</span> <span class="id" title="var">a</span>) <span class="id" title="var">_</span>) <span class="id" title="tactic">in</span> <span class="id" title="var">H0</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--- <span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">E3</span> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">burn_update_none_is_none</span> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span>. <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">instantiate</span> (<span class="id" title="var">AddBlockFacts</span> := <span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">True</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">instantiate</span> (<span class="id" title="var">DeployFacts</span> := <span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> <span class="id" title="var">ctx</span> =&gt; <span class="id" title="var">True</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">instantiate</span> (<span class="id" title="var">CallFacts</span> := <span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> <span class="id" title="var">ctx</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">True</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">unset_all</span>; <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">destruct_chain_step</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">destruct_action_eval</span>; <span class="id" title="tactic">auto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab85"></a><h2 class="section">Smaller version of <span class="inlinecode"><span class="id" title="var">no_metadata_no_supply</span></span></h2>

</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">no_metadata_no_supply_small</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">bstate</span> <span class="id" title="var">caddr</span> <span class="id" title="var">fa2_token_id</span> (<span class="id" title="var">trace</span>: <span class="id" title="var">ChainTrace</span> <span class="id" title="var">empty_state</span> <span class="id" title="var">bstate</span>),<br/>
<span class="id" title="var">env_contracts</span> <span class="id" title="var">bstate</span> <span class="id" title="var">caddr</span> = <span class="id" title="var">Some</span> (<span class="id" title="var">FA2_contract</span> : <span class="id" title="var">WeakContract</span>) -&gt;<br/>
<span class="id" title="tactic">exists</span> <span class="id" title="var">cstate</span>, <br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">FMap.find</span> <span class="id" title="var">fa2_token_id</span> <span class="id" title="var">cstate</span>.(<span class="id" title="var">fa2_assets</span>).(<span class="id" title="var">mts_token_metadata</span>) = <span class="id" title="var">None</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">FMap.find</span> <span class="id" title="var">fa2_token_id</span> <span class="id" title="var">cstate</span>.(<span class="id" title="var">fa2_assets</span>).(<span class="id" title="var">token_total_supply</span>) = <span class="id" title="var">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>. <span class="id" title="tactic">apply</span> (<span class="id" title="var">no_metadata_no_supply</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">fa2_token_id</span> <span class="id" title="var">trace</span>) <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">H</span> <span class="id" title="keyword">as</span> (<span class="id" title="var">cstate</span> &amp; <span class="id" title="var">H</span>). <span class="id" title="tactic">exists</span> <span class="id" title="var">cstate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>. <span class="id" title="var">easy</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab86"></a><h2 class="section">Not mints to a token before it is created</h2>

</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">fa2_no_mint_before_token_created</span> : <span class="id" title="keyword">forall</span> <span class="id" title="var">bstate</span> <span class="id" title="var">caddr</span> <span class="id" title="var">fa2_token_id</span> (<span class="id" title="var">trace</span>: <span class="id" title="var">ChainTrace</span> <span class="id" title="var">empty_state</span> <span class="id" title="var">bstate</span>),<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">env_contracts</span> <span class="id" title="var">bstate</span> <span class="id" title="var">caddr</span> = <span class="id" title="var">Some</span> (<span class="id" title="var">FA2_contract</span> : <span class="id" title="var">WeakContract</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">exists</span> <span class="id" title="var">cstate</span> <span class="id" title="var">inc_calls</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contract_state</span> <span class="id" title="var">bstate</span> <span class="id" title="var">caddr</span> = <span class="id" title="var">Some</span> <span class="id" title="var">cstate</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">incoming_calls</span> <span class="id" title="var">MultiAssetParam</span> <span class="id" title="var">trace</span> <span class="id" title="var">caddr</span> = <span class="id" title="var">Some</span> <span class="id" title="var">inc_calls</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">FMap.find</span> <span class="id" title="var">fa2_token_id</span> <span class="id" title="var">cstate</span>.(<span class="id" title="var">fa2_assets</span>).(<span class="id" title="var">mts_token_metadata</span>) = <span class="id" title="var">None</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">sumZ</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">callInfo</span> =&gt; <span class="id" title="var">mint_or_burn</span> <span class="id" title="var">fa2_token_id</span> <span class="id" title="var">callInfo</span>.(<span class="id" title="var">call_msg</span>)) <span class="id" title="var">inc_calls</span> = 0%<span class="id" title="var">Z</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contract_induction</span>; <span class="id" title="tactic">intros</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">unfold</span> <span class="id" title="var">callFrom</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">receive</span> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> *. <span class="id" title="tactic">destruct</span> <span class="id" title="var">msg</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>; <span class="id" title="tactic">destruct</span> <span class="id" title="var">m</span>; <span class="id" title="tactic">destruct</span> <span class="id" title="var">param</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id" title="var">erewrite</span> &lt;- <span class="id" title="var">assets_endpoint_preserves_metadata</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id" title="var">erewrite</span> &lt;- <span class="id" title="var">assets_endpoint_preserves_metadata</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id" title="var">erewrite</span> &lt;- <span class="id" title="var">assets_endpoint_preserves_metadata</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id" title="tactic">destruct</span> <span class="id" title="var">tokenAdmin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--- <span class="id" title="var">erewrite</span> &lt;- <span class="id" title="var">set_admin_preserves_metadata</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--- <span class="id" title="var">erewrite</span> &lt;- <span class="id" title="var">confirm_admin_preserves_metadata</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--- <span class="id" title="var">erewrite</span> &lt;- <span class="id" title="var">pause_preserves_metadata</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--- <span class="id" title="var">erewrite</span> &lt;- <span class="id" title="var">set_minter_preserves_metadata</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id" title="tactic">destruct</span> <span class="id" title="var">tokenMetaData</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">metadata_token_id</span> =? <span class="id" title="var">fa2_token_id</span>) <span class="id" title="var">eqn</span>:<span class="id" title="var">E</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--- <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">create_token</span> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">N.eqb_eq</span> <span class="id" title="tactic">in</span> <span class="id" title="var">E</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span>. <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">FMap.find</span> <span class="id" title="var">fa2_token_id</span> (<span class="id" title="var">mts_token_metadata</span> (<span class="id" title="var">fa2_assets</span> <span class="id" title="var">prev_state</span>))); <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--- <span class="id" title="tactic">rewrite</span> <span class="id" title="var">N.eqb_neq</span> <span class="id" title="tactic">in</span> <span class="id" title="var">E</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">create_new_token_changes_nothing_else</span> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">H1</span> <span class="id" title="tactic">in</span> <span class="id" title="var">IH</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IH</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>. <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id" title="var">erewrite</span> &lt;- <span class="id" title="var">mint_preserves_metadata</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IH</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span> <span class="id" title="keyword">as</span> <span class="id" title="var">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span>. <span class="id" title="tactic">destruct</span> (<span class="id" title="var">fail_if_not_minter</span> <span class="id" title="var">ctx</span> (<span class="id" title="var">fa2_admin</span> <span class="id" title="var">prev_state</span>)); <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">instantiate</span> (<span class="id" title="var">CallFacts</span> := <span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">prev_state</span> <span class="id" title="var">_</span> =&gt; (<span class="id" title="var">FMap.find</span> <span class="id" title="var">fa2_token_id</span> <span class="id" title="var">prev_state</span>.(<span class="id" title="var">fa2_assets</span>).(<span class="id" title="var">mts_token_metadata</span>) = <span class="id" title="var">None</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">FMap.find</span> <span class="id" title="var">fa2_token_id</span> <span class="id" title="var">prev_state</span>.(<span class="id" title="var">fa2_assets</span>).(<span class="id" title="var">token_total_supply</span>) = <span class="id" title="var">None</span>)). <span class="id" title="tactic">unfold</span> <span class="id" title="var">CallFacts</span> <span class="id" title="tactic">in</span> <span class="id" title="var">facts</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">facts</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">mint_update_total_supply</span> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">mint_or_burn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">p</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> *. <span class="id" title="tactic">destruct</span> (<span class="id" title="var">mint_burn_token_id</span> <span class="id" title="var">a</span> =? <span class="id" title="var">fa2_token_id</span>) <span class="id" title="var">eqn</span>: <span class="id" title="var">E2</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">N.eqb_eq</span> <span class="id" title="tactic">in</span> <span class="id" title="var">E2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">H</span> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">update_none_is_none</span> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id" title="var">erewrite</span> &lt;- <span class="id" title="var">burn_preserves_metadata</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IH</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span> <span class="id" title="keyword">as</span> <span class="id" title="var">H2</span>. <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">fail_if_not_minter</span> <span class="id" title="var">ctx</span> (<span class="id" title="var">fa2_admin</span> <span class="id" title="var">prev_state</span>)); <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">burn_update_balances</span> <span class="id" title="var">p</span> (<span class="id" title="var">ledger</span> (<span class="id" title="var">fa2_assets</span> <span class="id" title="var">prev_state</span>))); <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">burn_update_total_supply</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">p</span>; <span class="id" title="tactic">intros</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> *. <span class="id" title="tactic">destruct</span> (<span class="id" title="var">mint_burn_token_id</span> <span class="id" title="var">a</span> =? <span class="id" title="var">fa2_token_id</span>) <span class="id" title="var">eqn</span>: <span class="id" title="var">E2</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">N.eqb_eq</span> <span class="id" title="tactic">in</span> <span class="id" title="var">E2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">CallFacts</span> <span class="id" title="tactic">in</span> <span class="id" title="var">facts</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">facts</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">H</span> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">burn_update_none_is_none</span> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">unfold</span> <span class="id" title="var">callFrom</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">receive</span> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span>. <span class="id" title="tactic">simpl</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">msg</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>; <span class="id" title="tactic">destruct</span> <span class="id" title="var">m</span>; <span class="id" title="tactic">destruct</span> <span class="id" title="var">param</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id" title="var">erewrite</span> &lt;- <span class="id" title="var">assets_endpoint_preserves_metadata</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id" title="var">erewrite</span> &lt;- <span class="id" title="var">assets_endpoint_preserves_metadata</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id" title="var">erewrite</span> &lt;- <span class="id" title="var">assets_endpoint_preserves_metadata</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id" title="tactic">destruct</span> <span class="id" title="var">tokenAdmin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--- <span class="id" title="var">erewrite</span> &lt;- <span class="id" title="var">set_admin_preserves_metadata</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--- <span class="id" title="var">erewrite</span> &lt;- <span class="id" title="var">confirm_admin_preserves_metadata</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--- <span class="id" title="var">erewrite</span> &lt;- <span class="id" title="var">pause_preserves_metadata</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--- <span class="id" title="var">erewrite</span> &lt;- <span class="id" title="var">set_minter_preserves_metadata</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id" title="tactic">destruct</span> <span class="id" title="var">tokenMetaData</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">metadata_token_id</span> =? <span class="id" title="var">fa2_token_id</span>) <span class="id" title="var">eqn</span>:<span class="id" title="var">E</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--- <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">create_token</span> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">N.eqb_eq</span> <span class="id" title="tactic">in</span> <span class="id" title="var">E</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span>. <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">FMap.find</span> <span class="id" title="var">fa2_token_id</span> (<span class="id" title="var">mts_token_metadata</span> (<span class="id" title="var">fa2_assets</span> <span class="id" title="var">prev_state</span>))); <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--- <span class="id" title="tactic">rewrite</span> <span class="id" title="var">N.eqb_neq</span> <span class="id" title="tactic">in</span> <span class="id" title="var">E</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">create_new_token_changes_nothing_else</span> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">H1</span> <span class="id" title="tactic">in</span> <span class="id" title="var">IH</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IH</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>. <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id" title="var">erewrite</span> &lt;- <span class="id" title="var">mint_preserves_metadata</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IH</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span> <span class="id" title="keyword">as</span> <span class="id" title="var">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H2</span>. <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">fail_if_not_minter</span> <span class="id" title="var">ctx</span> (<span class="id" title="var">fa2_admin</span> <span class="id" title="var">prev_state</span>)); <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">CallFacts</span> <span class="id" title="tactic">in</span> <span class="id" title="var">facts</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">facts</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">mint_update_total_supply</span> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">mint_or_burn</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">p</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> *. <span class="id" title="tactic">destruct</span> (<span class="id" title="var">mint_burn_token_id</span> <span class="id" title="var">a</span> =? <span class="id" title="var">fa2_token_id</span>) <span class="id" title="var">eqn</span>: <span class="id" title="var">E2</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">N.eqb_eq</span> <span class="id" title="tactic">in</span> <span class="id" title="var">E2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">H</span> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">update_none_is_none</span> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id" title="var">erewrite</span> &lt;- <span class="id" title="var">burn_preserves_metadata</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IH</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span> <span class="id" title="keyword">as</span> <span class="id" title="var">H2</span>. <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">fail_if_not_minter</span> <span class="id" title="var">ctx</span> (<span class="id" title="var">fa2_admin</span> <span class="id" title="var">prev_state</span>)); <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">burn_update_balances</span> <span class="id" title="var">p</span> (<span class="id" title="var">ledger</span> (<span class="id" title="var">fa2_assets</span> <span class="id" title="var">prev_state</span>))); <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">burn_update_total_supply</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">p</span>; <span class="id" title="tactic">intros</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> *. <span class="id" title="tactic">destruct</span> (<span class="id" title="var">mint_burn_token_id</span> <span class="id" title="var">a</span> =? <span class="id" title="var">fa2_token_id</span>) <span class="id" title="var">eqn</span>: <span class="id" title="var">E2</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">N.eqb_eq</span> <span class="id" title="tactic">in</span> <span class="id" title="var">E2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">CallFacts</span> <span class="id" title="tactic">in</span> <span class="id" title="var">facts</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">facts</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">H</span> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">burn_update_none_is_none</span> <span class="id" title="tactic">in</span> <span class="id" title="var">receive_some</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">instantiate</span> (<span class="id" title="var">AddBlockFacts</span> := <span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">True</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">instantiate</span> (<span class="id" title="var">DeployFacts</span> := <span class="id" title="keyword">fun</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> =&gt; <span class="id" title="var">True</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">unset_all</span>; <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">destruct_chain_step</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">destruct_action_eval</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">state'</span> <span class="id" title="var">deployed'</span> <span class="id" title="var">deployed_state'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">deployed</span> <span class="id" title="tactic">in</span> <span class="id" title="var">deployed'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">deployed'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">from_reachable</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">trace</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">clear</span> <span class="id" title="var">deployed'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> <span class="id" title="var">no_metadata_no_supply</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">fa2_token_id</span> := <span class="id" title="var">fa2_token_id</span>) <span class="id" title="keyword">as</span> (<span class="id" title="var">state</span> &amp; <span class="id" title="var">state_deployed</span> &amp; ?); <span class="id" title="tactic">eauto</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">state_deployed</span> <span class="id" title="tactic">in</span> <span class="id" title="var">deployed_state'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">deployed_state'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">easy</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
<span class="id" title="keyword">End</span> <span class="id" title="var">FA2_Multi_Asset</span>.<br/>
</div>
</div>

<div id="footer">
<hr/><a href="index.html">Index</a><hr/>This page has been generated by <a href="http://coq.inria.fr/">coqdoc</a>
</div>

</div>

</body>
</html>