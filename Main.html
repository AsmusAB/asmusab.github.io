<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<link href="coqdoc.css" rel="stylesheet" type="text/css" />
<title>Main</title>
</head>

<body>

<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library Main</h1>

<div class="code">
</div>

<div class="doc">
<a name="lab161"></a><h1 class="section">The main entrypoint contract of the Minter Contract</h1>
 This file calls all sub parts of the minter contract, also located in this folder.
    All proofs for the sub parts(Fees, Contract Admin, Signer, SignerOps, Governance, Oracle) of the contracts are located in this file aswell
    The file this file has been translated from can be found here:
    https://github.com/bender-labs/wrap-tz-contracts/blob/1655949e61b05a1c25cc00dcb8c1da9d91799f31/ligo/minter/main.mligo

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">Storage</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">ZArith</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">Fees</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">Fees_Interface</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">Blockchain</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">Unwrap</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">ContractAdmin</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">Monads</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">RecordUpdate</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">Tokens_Lib</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">ContractCommon</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">Governance_Interface</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">Governance</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">Oracle_Interface</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">Oracle</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">Signer_Interface</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">Signer</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">Signer_Ops_Interface</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">SignerOps</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">Serializable</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">Ethereum_Lib</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">Containers</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">String</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">List</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="keyword">Types</span>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">ConCert.Examples.FA2</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">FA2Interface</span>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">ConCert.Execution</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">InterContractCommunication</span>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">ConCert.Utils</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">Extras</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">FA2_Multi_Asset</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">FA2Interface_Wrap</span>.<br/>
<span class="id" title="keyword">Import</span> <span class="id" title="var">ListNotations</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">Fees_Lib</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">TokenAdmin</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">FA2Types</span>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <span class="id" title="var">Main</span>.<br/>
<span class="id" title="keyword">Context</span> {<span class="id" title="var">BaseTypes</span> : <span class="id" title="var">ChainBase</span>}.<br/>
<span class="id" title="keyword">Set</span> <span class="id" title="var">Nonrecursive</span> <span class="id" title="var">Elimination</span> <span class="id" title="var">Schemes</span>.<br/>
<span class="id" title="keyword">Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">N_scope</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab162"></a><h2 class="section">The Main Entrypoints of the Minter Contract</h2>

</div>
<div class="code">
<span class="id" title="keyword">Inductive</span> <span class="id" title="var">EntryPoints</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Fees</span> (<span class="id" title="var">fees_entrypoints</span> : <span class="id" title="var">WithdrawalEntrypoint</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Unwrap</span> (<span class="id" title="var">unwrap_entrypoints</span> : <span class="id" title="var">UnwrapEntrypoints</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">ContractAdmin</span> (<span class="id" title="var">contract_admin_entrypoints</span> : <span class="id" title="var">ContractAdminEntrypoints</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Governance</span> (<span class="id" title="var">governance_entrypoints</span> : <span class="id" title="var">GovernanceEntrypoints</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Oracle</span> (<span class="id" title="var">oracle_entrypoints</span> : <span class="id" title="var">OracleEntrypoint</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Signer</span> (<span class="id" title="var">signer_entrypoints</span> : <span class="id" title="var">SignerEntrypoints</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Signer_Ops</span> (<span class="id" title="var">signer_ops_entrypoints</span> : <span class="id" title="var">SignerOpsEntrypoint</span>)<br/>
.<br/>

<br/>
</div>

<div class="doc">
<a name="lab163"></a><h2 class="section">The Class needed for init to be run</h2>

</div>
<div class="code">
<span class="id" title="keyword">Record</span> <span class="id" title="var">Setup</span> := {<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">quorum_contract</span> : <span class="id" title="var">Address</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">meta_data_uri</span> : <span class="id" title="var">N</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">setup_tokens</span> : <span class="id" title="var">list</span> <span class="id" title="var">EthAddress</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">nft_contracts</span> : <span class="id" title="var">FMap</span> <span class="id" title="var">EthAddress</span> <span class="id" title="var">Address</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">fa2_contract</span> : <span class="id" title="var">Address</span><br/>
}.<br/>

<br/>

<br/>
</div>

<div class="doc">
<a name="lab164"></a><h2 class="section">Function to fail if the minter is paused</h2>

</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <span class="id" title="var">fail_if_paused</span> (<span class="id" title="var">s</span> : <span class="id" title="var">ContractAdminStorage</span>) : <span class="id" title="var">option</span> <span class="id" title="var">unit</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">throwIf</span> (<span class="id" title="var">s</span>.(<span class="id" title="var">paused</span>)).<br/>

<br/>
</div>

<div class="doc">
<a name="lab165"></a><h2 class="section">The Main entrypoint function for the whole Minter Contract</h2>

</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <span class="id" title="var">main</span> (<span class="id" title="var">ctx</span>: <span class="id" title="var">ContractCallContext</span>) (<span class="id" title="var">p</span>: <span class="id" title="var">EntryPoints</span>) (<span class="id" title="var">s</span> : <span class="id" title="var">State</span>) : <span class="id" title="var">option</span> <span class="id" title="var">ReturnType</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">p</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Signer</span> <span class="id" title="var">p</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">do</span> <span class="id" title="var">_</span> &lt;- <span class="id" title="var">fail_if_not_signer</span> <span class="id" title="var">ctx</span> <span class="id" title="var">s</span>.(<span class="id" title="var">admin</span>) ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">do</span> <span class="id" title="var">_</span> &lt;- <span class="id" title="var">fail_if_paused</span> <span class="id" title="var">s</span>.(<span class="id" title="var">admin</span>) ; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">signer_main</span> <span class="id" title="var">ctx</span> <span class="id" title="var">p</span> <span class="id" title="var">s</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Unwrap</span> <span class="id" title="var">p</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">do</span> <span class="id" title="var">_</span> &lt;- <span class="id" title="var">fail_if_paused</span> <span class="id" title="var">s</span>.(<span class="id" title="var">admin</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">unwrap_main</span> <span class="id" title="var">ctx</span> <span class="id" title="var">p</span> <span class="id" title="var">s</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">ContractAdmin</span> <span class="id" title="var">p</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">do</span> <span class="id" title="var">_</span> &lt;- <span class="id" title="var">fail_if_amount</span> <span class="id" title="var">ctx</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">do</span> <span class="id" title="var">res</span> &lt;- <span class="id" title="var">contract_admin_main</span> <span class="id" title="var">ctx</span> <span class="id" title="var">p</span> <span class="id" title="var">s</span>.(<span class="id" title="var">admin</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Some</span> (<span class="id" title="var">s</span>&lt;|<span class="id" title="var">admin</span>:= <span class="id" title="var">snd</span> <span class="id" title="var">res</span>|&gt;, <span class="id" title="var">fst</span> <span class="id" title="var">res</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Governance</span> <span class="id" title="var">p</span> =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">do</span> <span class="id" title="var">_</span> &lt;- <span class="id" title="var">fail_if_amount</span> <span class="id" title="var">ctx</span> ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">do</span> <span class="id" title="var">_</span> &lt;- <span class="id" title="var">fail_if_not_governance</span> <span class="id" title="var">ctx</span> <span class="id" title="var">s</span>.(<span class="id" title="var">governance</span>) ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">do</span> <span class="id" title="var">res</span> &lt;- <span class="id" title="var">governance_main</span> <span class="id" title="var">ctx</span> <span class="id" title="var">p</span> <span class="id" title="var">s</span>.(<span class="id" title="var">governance</span>) ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Some</span> (<span class="id" title="var">s</span>&lt;|<span class="id" title="var">governance</span> := <span class="id" title="var">snd</span> <span class="id" title="var">res</span>|&gt;, <span class="id" title="var">fst</span> <span class="id" title="var">res</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Fees</span> <span class="id" title="var">p</span> =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">do</span> <span class="id" title="var">_</span> &lt;- <span class="id" title="var">fail_if_amount</span> <span class="id" title="var">ctx</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">fees_main</span> <span class="id" title="var">ctx</span> <span class="id" title="var">s</span> <span class="id" title="var">p</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Oracle</span> <span class="id" title="var">p</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">do</span> <span class="id" title="var">_</span> &lt;- <span class="id" title="var">fail_if_amount</span> <span class="id" title="var">ctx</span> ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">do</span> <span class="id" title="var">_</span> &lt;- <span class="id" title="var">fail_if_not_oracle</span> <span class="id" title="var">ctx</span> <span class="id" title="var">s</span>.(<span class="id" title="var">admin</span>) ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">oracle_main</span> <span class="id" title="var">ctx</span> <span class="id" title="var">p</span> <span class="id" title="var">s</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Signer_Ops</span> <span class="id" title="var">p</span> =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">do</span> <span class="id" title="var">_</span> &lt;- <span class="id" title="var">fail_if_amount</span> <span class="id" title="var">ctx</span> ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">do</span> <span class="id" title="var">_</span> &lt;- <span class="id" title="var">fail_if_not_signer</span> <span class="id" title="var">ctx</span> <span class="id" title="var">s</span>.(<span class="id" title="var">admin</span>) ; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">signer_ops_main</span> <span class="id" title="var">ctx</span> <span class="id" title="var">p</span> <span class="id" title="var">s</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab166"></a><h2 class="section">Receive function used to connect the main function to the context state</h2>

</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <span class="id" title="var">minter_receive</span> (<span class="id" title="var">chain</span> : <span class="id" title="var">Chain</span>) (<span class="id" title="var">ctx</span> : <span class="id" title="var">ContractCallContext</span>) (<span class="id" title="var">state</span> : <span class="id" title="var">State</span>) (<span class="id" title="var">msg_opt</span> : <span class="id" title="var">option</span> <span class="id" title="var">EntryPoints</span>) : <span class="id" title="var">option</span> <span class="id" title="var">ReturnType</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">do</span> <span class="id" title="var">msg</span> &lt;- <span class="id" title="var">msg_opt</span> ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">main</span> <span class="id" title="var">ctx</span> <span class="id" title="var">msg</span> <span class="id" title="var">state</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab167"></a><h2 class="section">The init function run when initializing or deploying the Minter Contract</h2>

</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <span class="id" title="var">minter_init</span> (<span class="id" title="var">chain</span> : <span class="id" title="var">Chain</span>) (<span class="id" title="var">ctx</span> : <span class="id" title="var">ContractCallContext</span>) (<span class="id" title="var">setup</span> : <span class="id" title="var">Setup</span>) : <span class="id" title="var">option</span> <span class="id" title="var">State</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">meta</span> := <span class="id" title="var">FMap.update</span> <span class="id" title="var">EmptyString</span> (<span class="id" title="var">Some</span> <span class="id" title="var">setup</span>.(<span class="id" title="var">meta_data_uri</span>)) <span class="id" title="var">FMap.empty</span> <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">fungible_tokens</span> := <span class="id" title="var">fold_left</span> (<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">fun</span> (<span class="id" title="var">acc</span> : (<span class="id" title="var">N</span> * <span class="id" title="var">FMap</span> <span class="id" title="var">EthAddress</span> <span class="id" title="var">TokenAddress</span>)) (<span class="id" title="var">eth_contract</span> : <span class="id" title="var">EthAddress</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((<span class="id" title="var">fst</span> <span class="id" title="var">acc</span>) + 1, <span class="id" title="var">FMap.update</span> <span class="id" title="var">eth_contract</span> (<span class="id" title="var">Some</span> (<span class="id" title="var">setup</span>.(<span class="id" title="var">fa2_contract</span>), <span class="id" title="var">fst</span> <span class="id" title="var">acc</span>)) (<span class="id" title="var">snd</span> <span class="id" title="var">acc</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;) <span class="id" title="var">setup</span>.(<span class="id" title="var">setup_tokens</span>) (0, <span class="id" title="var">FMap.empty</span>) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Some</span> {| <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">admin</span> := {| <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">administrator</span> := <span class="id" title="var">ctx</span>.(<span class="id" title="var">ctx_from</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">pending_admin</span> := <span class="id" title="var">None</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">oracle</span> := <span class="id" title="var">setup</span>.(<span class="id" title="var">quorum_contract</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">signer</span> := <span class="id" title="var">setup</span>.(<span class="id" title="var">quorum_contract</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">paused</span> := <span class="id" title="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|};<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">assets</span> := {|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">erc20tokens</span> := <span class="id" title="var">snd</span> <span class="id" title="var">fungible_tokens</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">erc721tokens</span> := <span class="id" title="var">setup</span>.(<span class="id" title="var">nft_contracts</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">mints</span> := <span class="id" title="var">FMap.empty</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|};<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">fees</span> := {|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">fees_storage_signers</span> := <span class="id" title="var">FMap.empty</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">fees_storage_tokens</span> := <span class="id" title="var">FMap.empty</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">fees_storage_xtz</span> := <span class="id" title="var">FMap.empty</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|};<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">governance</span> := {|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contract</span> := <span class="id" title="var">ctx</span>.(<span class="id" title="var">ctx_from</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">staking_address</span> := <span class="id" title="var">ctx</span>.(<span class="id" title="var">ctx_from</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">dev_pool_address</span> := <span class="id" title="var">ctx</span>.(<span class="id" title="var">ctx_from</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">erc20_wrapping_fees</span> := 15;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">erc20_unwrapping_fees</span> := 15;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">erc721_wrapping_fees</span> := 500000;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">erc721_unwrapping_fees</span> := 500000;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">fees_share_rec</span> := {|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">dev_pool</span> := 10;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">signers</span> := 50;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">staking</span> := 40<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|};<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">storage_metadata</span> := <span class="id" title="var">meta</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;|}.<br/>

<br/>
</div>

<div class="doc">
<a name="lab168"></a><h2 class="section">The type definition of the minter contract</h2>

</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <span class="id" title="var">minter_contract</span> : <span class="id" title="var">Contract</span> <span class="id" title="var">Setup</span> <span class="id" title="var">EntryPoints</span> <span class="id" title="var">State</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">build_contract</span> <span class="id" title="var">minter_init</span> <span class="id" title="var">minter_receive</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab169"></a><h1 class="section">Signer Proofs</h1>
 All of the Signer proofs are in this section, the definition of the contract part can be found in the Signer.v and Signer_Interface.v 
<div class="paragraph"> </div>

<a name="lab170"></a><h2 class="section">Functional correctness of minting erc20 functionality</h2>

</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">mint_erc20_functionally_correct</span> {<span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">prev_state</span> <span class="id" title="var">next_state</span> <span class="id" title="var">erc20Address</span> <span class="id" title="var">event_id</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">owner</span> <span class="id" title="var">amount</span> <span class="id" title="var">acts</span> <span class="id" title="var">token_address</span> <span class="id" title="var">v</span> <span class="id" title="var">new_v</span> <span class="id" title="var">n</span> <span class="id" title="var">feesVal</span>} : <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">minter_receive</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">prev_state</span> (<span class="id" title="var">Some</span> (<span class="id" title="var">Signer</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">Mint_erc20</span> {|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">erc20</span> := <span class="id" title="var">erc20Address</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">event_id_erc20</span> := <span class="id" title="var">event_id</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">owner_erc20</span> := <span class="id" title="var">owner</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">amount_erc20</span> :=<span class="id" title="var">amount</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|}))) = <span class="id" title="var">Some</span> (<span class="id" title="var">next_state</span>, <span class="id" title="var">acts</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">prev_state</span>.(<span class="id" title="var">governance</span>).(<span class="id" title="var">erc20_wrapping_fees</span>) = <span class="id" title="var">n</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">FMap.find</span> <span class="id" title="var">erc20Address</span> <span class="id" title="var">prev_state</span>.(<span class="id" title="var">assets</span>).(<span class="id" title="var">erc20tokens</span>) = <span class="id" title="var">Some</span> <span class="id" title="var">token_address</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">FMap.find</span> (<span class="id" title="var">ctx</span>.(<span class="id" title="var">ctx_contract_address</span>), <span class="id" title="var">token_address</span>) <span class="id" title="var">prev_state</span>.(<span class="id" title="var">fees</span>).(<span class="id" title="var">fees_storage_tokens</span>) = <span class="id" title="var">Some</span> <span class="id" title="var">v</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">FMap.find</span> (<span class="id" title="var">ctx</span>.(<span class="id" title="var">ctx_contract_address</span>), <span class="id" title="var">token_address</span>) <span class="id" title="var">next_state</span>.(<span class="id" title="var">fees</span>).(<span class="id" title="var">fees_storage_tokens</span>) = <span class="id" title="var">Some</span> <span class="id" title="var">new_v</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">feesVal</span> = (<span class="id" title="var">amount</span> * <span class="id" title="var">n</span> / 10000) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">v</span> + <span class="id" title="var">feesVal</span> = <span class="id" title="var">new_v</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">mintToOwner</span> := {|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">mint_burn_owner</span> := <span class="id" title="var">owner</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">mint_burn_token_id</span> := <span class="id" title="var">snd</span> <span class="id" title="var">token_address</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">mint_burn_amount</span> := <span class="id" title="var">amount</span> - <span class="id" title="var">feesVal</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;|} <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">mintFees</span> := {|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">mint_burn_owner</span> := <span class="id" title="var">ctx</span>.(<span class="id" title="var">ctx_contract_address</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">mint_burn_token_id</span> := <span class="id" title="var">snd</span> <span class="id" title="var">token_address</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">mint_burn_amount</span> := <span class="id" title="var">feesVal</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;|} <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> 0 &lt;?  <span class="id" title="var">feesVal</span> <span class="id" title="keyword">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">acts</span> = [<span class="id" title="var">act_call</span> (<span class="id" title="var">fst</span> <span class="id" title="var">token_address</span>) 0 (<span class="id" title="var">serialize</span> (<span class="id" title="var">MintTokens</span> [<span class="id" title="var">mintToOwner</span> ; <span class="id" title="var">mintFees</span>]))]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">acts</span> = [<span class="id" title="var">act_call</span> (<span class="id" title="var">fst</span> <span class="id" title="var">token_address</span>) 0 (<span class="id" title="var">serialize</span> (<span class="id" title="var">MintTokens</span> [<span class="id" title="var">mintToOwner</span>]))].<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">H4</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span> <span class="id" title="var">minter_receive</span> <span class="id" title="var">minter_init</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intro</span>. <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;-   <span class="id" title="tactic">unfold</span> <span class="id" title="var">get_fa2_token_id</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H9</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">H9</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">Fees_Lib.token_balance</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">FMap.find_add</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">Fees_Lib.token_balance</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">H2</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> *.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">Fees_Lib.bps_of</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">now</span> <span class="id" title="tactic">inversion</span> <span class="id" title="var">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;-   <span class="id" title="tactic">unfold</span> <span class="id" title="var">get_fa2_token_id</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H9</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">H9</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">feesVal</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">bps_of</span> <span class="id" title="tactic">in</span> *; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H8</span>; <span class="id" title="var">now</span> <span class="id" title="var">cbn</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab171"></a><h2 class="section">Functional correctness of adding new erc20 token</h2>

</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">add_erc20_functionally_correct</span> {<span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">prev_state</span> <span class="id" title="var">next_state</span> <span class="id" title="var">eth_contract</span> <span class="id" title="var">token_address</span> <span class="id" title="var">acts</span> <span class="id" title="var">ta</span>} : <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">minter_receive</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">prev_state</span> (<span class="id" title="var">Some</span> (<span class="id" title="var">Signer</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">Add_erc20</span> {|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">eth_contract_erc20</span> := <span class="id" title="var">eth_contract</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">token_address</span> := <span class="id" title="var">token_address</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|}))) = <span class="id" title="var">Some</span> (<span class="id" title="var">next_state</span>, <span class="id" title="var">acts</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">FMap.find</span> <span class="id" title="var">eth_contract</span> <span class="id" title="var">next_state</span>.(<span class="id" title="var">assets</span>).(<span class="id" title="var">erc20tokens</span>) = <span class="id" title="var">Some</span> <span class="id" title="var">ta</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">ta</span> = <span class="id" title="var">token_address</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span> <span class="id" title="var">minter_receive</span> <span class="id" title="var">minter_init</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">FMap.find_add</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H0</span>. <span class="id" title="var">easy</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab172"></a><h2 class="section">Functional correctness of minting erc 721</h2>

</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">mint_erc721_functionally_correct</span> {<span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">prev_state</span> <span class="id" title="var">next_state</span> <span class="id" title="var">erc721Address</span> <span class="id" title="var">event_id</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">owner</span> <span class="id" title="var">amount</span> <span class="id" title="var">acts</span> <span class="id" title="var">token_address</span> <span class="id" title="var">v</span> <span class="id" title="var">new_v</span> <span class="id" title="var">n</span> <span class="id" title="var">token_id</span> <span class="id" title="var">contract_address</span> } : <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">minter_receive</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">prev_state</span> (<span class="id" title="var">Some</span> (<span class="id" title="var">Signer</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">Mint_erc721</span> {|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">erc721</span> := <span class="id" title="var">erc721Address</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">event_id_erc721</span> := <span class="id" title="var">event_id</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">owner_erc721</span> := <span class="id" title="var">owner</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">token_id_erc721</span> := <span class="id" title="var">token_id</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|}))) = <span class="id" title="var">Some</span> (<span class="id" title="var">next_state</span>, <span class="id" title="var">acts</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">ctx</span>.(<span class="id" title="var">ctx_amount</span>) = <span class="id" title="var">amount</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">prev_state</span>.(<span class="id" title="var">governance</span>).(<span class="id" title="var">erc721_wrapping_fees</span>) = <span class="id" title="var">n</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">FMap.find</span> <span class="id" title="var">erc721Address</span> <span class="id" title="var">prev_state</span>.(<span class="id" title="var">assets</span>).(<span class="id" title="var">erc721tokens</span>) = <span class="id" title="var">Some</span> <span class="id" title="var">token_address</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">ctx</span>.(<span class="id" title="var">ctx_contract_address</span>) = <span class="id" title="var">contract_address</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">FMap.find</span> <span class="id" title="var">contract_address</span> <span class="id" title="var">prev_state</span>.(<span class="id" title="var">fees</span>).(<span class="id" title="var">fees_storage_xtz</span>) = <span class="id" title="var">Some</span> <span class="id" title="var">v</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">FMap.find</span> <span class="id" title="var">contract_address</span> <span class="id" title="var">next_state</span>.(<span class="id" title="var">fees</span>).(<span class="id" title="var">fees_storage_xtz</span>) = <span class="id" title="var">Some</span> <span class="id" title="var">new_v</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">v</span> + (<span class="id" title="var">Z.to_N</span> <span class="id" title="var">amount</span>) = <span class="id" title="var">new_v</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">mintBurnToOwner</span> := {|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">mint_burn_owner</span> := <span class="id" title="var">owner</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">mint_burn_token_id</span> := <span class="id" title="var">token_id</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">mint_burn_amount</span> := 1<br/>
&nbsp;&nbsp;&nbsp;&nbsp;|} <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">acts</span> = [<span class="id" title="var">act_call</span> <span class="id" title="var">token_address</span> 0 (<span class="id" title="var">serialize</span> (<span class="id" title="var">MintTokens</span> [<span class="id" title="var">mintBurnToOwner</span>]))].<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span> <span class="id" title="var">minter_receive</span> <span class="id" title="var">minter_init</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">FMap.find_add</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H5</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">H4</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H5</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H5</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">unfold</span> <span class="id" title="var">get_nft_contract</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H10</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">easy</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab173"></a><h2 class="section">Functional correctness of adding erc721 tokens</h2>

</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">add_erc721_functionally_correct</span> {<span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">prev_state</span> <span class="id" title="var">next_state</span> <span class="id" title="var">eth_contract</span> <span class="id" title="var">token_contract</span> <span class="id" title="var">acts</span> <span class="id" title="var">tc</span>} : <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">minter_receive</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">prev_state</span> (<span class="id" title="var">Some</span> (<span class="id" title="var">Signer</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">Add_erc721</span> {|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">eth_contract_erc721</span> := <span class="id" title="var">eth_contract</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">token_contract</span> := <span class="id" title="var">token_contract</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|}))) = <span class="id" title="var">Some</span> (<span class="id" title="var">next_state</span>, <span class="id" title="var">acts</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">FMap.find</span> <span class="id" title="var">eth_contract</span> <span class="id" title="var">next_state</span>.(<span class="id" title="var">assets</span>).(<span class="id" title="var">erc721tokens</span>) = <span class="id" title="var">Some</span> <span class="id" title="var">tc</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">tc</span> = <span class="id" title="var">token_contract</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span> <span class="id" title="var">minter_receive</span> <span class="id" title="var">minter_init</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">FMap.find_add</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">easy</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab174"></a><h1 class="section">Contract Admin Proofs</h1>
 All of the contract admin proofs, the definitions can be found in ContractAdmin.v <a name="lab175"></a><h2 class="section">Set administrator correct</h2>

</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">set_administrator_correct</span> {<span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">prev_state</span> <span class="id" title="var">next_state</span> <span class="id" title="var">n</span>} : <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">minter_receive</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">prev_state</span> (<span class="id" title="var">Some</span> (<span class="id" title="var">ContractAdmin</span> (<span class="id" title="var">SetAdministrator</span> <span class="id" title="var">n</span>))) = <span class="id" title="var">Some</span> (<span class="id" title="var">next_state</span>, []) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">next_state</span>.(<span class="id" title="var">admin</span>).(<span class="id" title="var">administrator</span>) = <span class="id" title="var">n</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span> <span class="id" title="var">minter_receive</span> <span class="id" title="var">minter_init</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">easy</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab176"></a><h2 class="section">Set signer correct</h2>

</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">set_signer_correct</span> {<span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">prev_state</span> <span class="id" title="var">next_state</span> <span class="id" title="var">n</span>} : <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">minter_receive</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">prev_state</span> (<span class="id" title="var">Some</span> (<span class="id" title="var">ContractAdmin</span> (<span class="id" title="var">SetSigner</span> <span class="id" title="var">n</span>))) = <span class="id" title="var">Some</span> (<span class="id" title="var">next_state</span>, []) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">next_state</span>.(<span class="id" title="var">admin</span>).(<span class="id" title="var">signer</span>) = <span class="id" title="var">n</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span> <span class="id" title="var">minter_receive</span> <span class="id" title="var">minter_init</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">easy</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab177"></a><h2 class="section">Set Oracle correct</h2>

</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">set_oracle_correct</span> {<span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">prev_state</span> <span class="id" title="var">next_state</span> <span class="id" title="var">n</span>} : <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">minter_receive</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">prev_state</span> (<span class="id" title="var">Some</span> (<span class="id" title="var">ContractAdmin</span> (<span class="id" title="var">SetOracle</span> <span class="id" title="var">n</span>))) = <span class="id" title="var">Some</span> (<span class="id" title="var">next_state</span>, []) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">next_state</span>.(<span class="id" title="var">admin</span>).(<span class="id" title="var">oracle</span>) = <span class="id" title="var">n</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span> <span class="id" title="var">minter_receive</span> <span class="id" title="var">minter_init</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">easy</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab178"></a><h2 class="section">Confirm new admin correct</h2>

</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">confirm_new_admin_correct</span> {<span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">addr</span> <span class="id" title="var">prev_state</span> <span class="id" title="var">next_state</span>} :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">prev_state</span>.(<span class="id" title="var">admin</span>).(<span class="id" title="var">pending_admin</span>) = <span class="id" title="var">Some</span> <span class="id" title="var">addr</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">minter_receive</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">prev_state</span> (<span class="id" title="var">Some</span> (<span class="id" title="var">ContractAdmin</span> (<span class="id" title="var">ConfirmMinterAdmin</span>))) = <span class="id" title="var">Some</span> (<span class="id" title="var">next_state</span>, []) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">next_state</span>.(<span class="id" title="var">admin</span>).(<span class="id" title="var">pending_admin</span>) = <span class="id" title="var">None</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">next_state</span>.(<span class="id" title="var">admin</span>).(<span class="id" title="var">administrator</span>) = <span class="id" title="var">addr</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span> <span class="id" title="var">minter_receive</span> <span class="id" title="var">minter_init</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">confirm_new_minter_admin</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">destruct_address_eq</span>; <span class="id" title="tactic">intros</span>; <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> *; <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">e</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H3</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">easy</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab179"></a><h2 class="section">Pause contract correct</h2>

</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">pause_contract_correct</span> {<span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">prev_state</span> <span class="id" title="var">next_state</span> <span class="id" title="var">b</span>} :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">minter_receive</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">prev_state</span> (<span class="id" title="var">Some</span> (<span class="id" title="var">ContractAdmin</span> (<span class="id" title="var">PauseContract</span> <span class="id" title="var">b</span>))) = <span class="id" title="var">Some</span> (<span class="id" title="var">next_state</span>, []) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">next_state</span>.(<span class="id" title="var">admin</span>).(<span class="id" title="var">paused</span>) = <span class="id" title="var">b</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span> <span class="id" title="var">minter_receive</span> <span class="id" title="var">minter_init</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">easy</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab180"></a><h1 class="section">Fees proofs</h1>
 All of the fees proofs, the definition of the functionality can be found in the Fees_Interface.v Fees_Lib.v Fees.v
<div class="paragraph"> </div>

<a name="lab181"></a><h2 class="section">Withdraw all tokens correct</h2>

</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">Withdraw_all_tokens_is_functionally_correct</span> {<span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">prev_state</span> <span class="id" title="var">p</span> <span class="id" title="var">next_state</span> <span class="id" title="var">ops</span> <span class="id" title="var">token_id</span> <span class="id" title="var">amount</span>} :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">minter_receive</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">prev_state</span> (<span class="id" title="var">Some</span> (<span class="id" title="var">Fees</span> (<span class="id" title="var">Withdraw_all_tokens</span> <span class="id" title="var">p</span>))) = <span class="id" title="var">Some</span> (<span class="id" title="var">next_state</span>, <span class="id" title="var">ops</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">p</span>.(<span class="id" title="var">wtp_tokens</span>) = [<span class="id" title="var">token_id</span>] -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">token_balance</span> <span class="id" title="var">prev_state</span>.(<span class="id" title="var">fees</span>).(<span class="id" title="var">fees_storage_tokens</span>) <span class="id" title="var">ctx</span>.(<span class="id" title="var">ctx_from</span>) (<span class="id" title="var">p</span>.(<span class="id" title="var">wtp_fa2_tokens</span>), <span class="id" title="var">token_id</span>) = <span class="id" title="var">amount</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">token_balance</span> <span class="id" title="var">next_state</span>.(<span class="id" title="var">fees</span>).(<span class="id" title="var">fees_storage_tokens</span>) <span class="id" title="var">ctx</span>.(<span class="id" title="var">ctx_from</span>) (<span class="id" title="var">p</span>.(<span class="id" title="var">wtp_fa2_tokens</span>), <span class="id" title="var">token_id</span>) = 0 /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">if</span> <span class="id" title="var">amount</span> =? 0 <span class="id" title="keyword">then</span> <span class="id" title="var">ops</span> = [] <span class="id" title="keyword">else</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">ops</span> = [<span class="id" title="var">act_call</span> <span class="id" title="var">ctx</span>.(<span class="id" title="var">ctx_contract_address</span>) (<span class="id" title="var">N_to_amount</span> 0) (<span class="id" title="var">serialize</span> (<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">from_</span> := <span class="id" title="var">p</span>.(<span class="id" title="var">wtp_fa2_tokens</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">txs</span> := [{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">to_</span> := <span class="id" title="var">ctx</span>.(<span class="id" title="var">ctx_from</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">dst_token_id</span> := <span class="id" title="var">token_id</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">amount</span> := <span class="id" title="var">amount</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|}]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;))]).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span> <span class="id" title="var">minter_receive</span> <span class="id" title="var">minter_init</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">generate_tokens_transfer</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">generate_tx_destinations</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H0</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>. <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H1</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">amount</span> =? 0) <span class="id" title="var">eqn</span>:<span class="id" title="var">E</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">split</span>; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">N.eqb_eq</span> <span class="id" title="tactic">in</span> <span class="id" title="var">E</span>; <span class="id" title="tactic">try</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">E</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">rewrite</span> <span class="id" title="var">E</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">unfold</span> <span class="id" title="var">token_balance</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">FMap.find_remove</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab182"></a><h2 class="section">Withdraw tokens correct</h2>

</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">Withdraw_tokens_is_functionally_correct</span> {<span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">prev_state</span> <span class="id" title="var">p</span> <span class="id" title="var">next_state</span> <span class="id" title="var">ops</span> <span class="id" title="var">amount</span>} :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">minter_receive</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">prev_state</span> (<span class="id" title="var">Some</span> (<span class="id" title="var">Fees</span> (<span class="id" title="var">Withdraw_token</span> <span class="id" title="var">p</span>))) = <span class="id" title="var">Some</span> (<span class="id" title="var">next_state</span>, <span class="id" title="var">ops</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">token_balance</span> <span class="id" title="var">prev_state</span>.(<span class="id" title="var">fees</span>).(<span class="id" title="var">fees_storage_tokens</span>) <span class="id" title="var">ctx</span>.(<span class="id" title="var">ctx_from</span>) (<span class="id" title="var">p</span>.(<span class="id" title="var">fa2_token</span>), <span class="id" title="var">p</span>.(<span class="id" title="var">wtp_token_id</span>)) = <span class="id" title="var">amount</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">token_balance</span> <span class="id" title="var">next_state</span>.(<span class="id" title="var">fees</span>).(<span class="id" title="var">fees_storage_tokens</span>) <span class="id" title="var">ctx</span>.(<span class="id" title="var">ctx_from</span>) (<span class="id" title="var">p</span>.(<span class="id" title="var">fa2_token</span>), <span class="id" title="var">p</span>.(<span class="id" title="var">wtp_token_id</span>)) = <span class="id" title="var">amount</span> - <span class="id" title="var">p</span>.(<span class="id" title="var">wtp_amount</span>) /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">ops</span> = [<span class="id" title="var">act_call</span> <span class="id" title="var">ctx</span>.(<span class="id" title="var">ctx_contract_address</span>) (<span class="id" title="var">N_to_amount</span> 0) (<span class="id" title="var">serialize</span> (<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">from_</span> := <span class="id" title="var">p</span>.(<span class="id" title="var">fa2_token</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">txs</span> := [{|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">to_</span> := <span class="id" title="var">ctx</span>.(<span class="id" title="var">ctx_from</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">dst_token_id</span> := <span class="id" title="var">p</span>.(<span class="id" title="var">wtp_token_id</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">amount</span> := <span class="id" title="var">p</span>.(<span class="id" title="var">wtp_amount</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|}]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|}))].<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span> <span class="id" title="var">minter_receive</span> <span class="id" title="var">minter_init</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">destruct</span> (<span class="id" title="var">token_balance</span> (<span class="id" title="var">fees_storage_tokens</span> (<span class="id" title="var">fees</span> <span class="id" title="var">prev_state</span>)) (<span class="id" title="var">ctx_from</span> <span class="id" title="var">ctx</span>) (<span class="id" title="var">fa2_token</span> <span class="id" title="var">p</span>, <span class="id" title="var">wtp_token_id</span> <span class="id" title="var">p</span>) - <span class="id" title="var">wtp_amount</span> <span class="id" title="var">p</span>) <span class="id" title="var">eqn</span>:<span class="id" title="var">E</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">unfold</span> <span class="id" title="var">token_balance</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">FMap.find_remove</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">unfold</span> <span class="id" title="var">token_balance</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">FMap.find_add</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">unfold</span> <span class="id" title="var">transfer_operation</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab183"></a><h2 class="section">Withdraw all xtz correct</h2>

</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">Withdraw_all_xtz_is_functionally_correct</span> {<span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">prev_state</span> <span class="id" title="var">next_state</span> <span class="id" title="var">ops</span> <span class="id" title="var">amount</span>} :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">minter_receive</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">prev_state</span> (<span class="id" title="var">Some</span> (<span class="id" title="var">Fees</span> (<span class="id" title="var">Withdraw_all_xtz</span>))) = <span class="id" title="var">Some</span> (<span class="id" title="var">next_state</span>, <span class="id" title="var">ops</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">xtz_balance</span> <span class="id" title="var">prev_state</span>.(<span class="id" title="var">fees</span>).(<span class="id" title="var">fees_storage_xtz</span>) <span class="id" title="var">ctx</span>.(<span class="id" title="var">ctx_from</span>) = <span class="id" title="var">amount</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">xtz_balance</span> <span class="id" title="var">next_state</span>.(<span class="id" title="var">fees</span>).(<span class="id" title="var">fees_storage_xtz</span>) <span class="id" title="var">ctx</span>.(<span class="id" title="var">ctx_from</span>) = 0 /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">if</span> <span class="id" title="var">amount</span> =? 0 <span class="id" title="keyword">then</span> <span class="id" title="var">ops</span> = [] <span class="id" title="keyword">else</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">ops</span> = [<span class="id" title="var">act_transfer</span> <span class="id" title="var">ctx</span>.(<span class="id" title="var">ctx_from</span>) (<span class="id" title="var">N_to_amount</span> <span class="id" title="var">amount</span>)]).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span> <span class="id" title="var">minter_receive</span> <span class="id" title="var">minter_init</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">xtz_balance</span> (<span class="id" title="var">fees_storage_xtz</span> (<span class="id" title="var">fees</span> <span class="id" title="var">prev_state</span>)) (<span class="id" title="var">ctx_from</span> <span class="id" title="var">ctx</span>) =? 0) <span class="id" title="var">eqn</span>:<span class="id" title="var">E</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">inversion</span> <span class="id" title="var">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">N.eqb_eq</span> <span class="id" title="tactic">in</span> <span class="id" title="var">E</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">destruct</span> (<span class="id" title="var">throwIf</span> (<span class="id" title="var">address_is_contract</span> (<span class="id" title="var">ctx_from</span> <span class="id" title="var">ctx</span>))); <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">N.sub_diag</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">xtz_balance</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">FMap.find_remove</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab184"></a><h2 class="section">Withdraw xtz correct</h2>

</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">Withdraw_xtz_is_functionally_correct</span> {<span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">prev_state</span> <span class="id" title="var">next_state</span> <span class="id" title="var">ops</span> <span class="id" title="var">amount</span> <span class="id" title="var">n</span>} :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">minter_receive</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">prev_state</span> (<span class="id" title="var">Some</span> (<span class="id" title="var">Fees</span> (<span class="id" title="var">Withdraw_xtz</span> <span class="id" title="var">n</span>))) = <span class="id" title="var">Some</span> (<span class="id" title="var">next_state</span>, <span class="id" title="var">ops</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">xtz_balance</span> <span class="id" title="var">prev_state</span>.(<span class="id" title="var">fees</span>).(<span class="id" title="var">fees_storage_xtz</span>) <span class="id" title="var">ctx</span>.(<span class="id" title="var">ctx_from</span>) = <span class="id" title="var">amount</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">xtz_balance</span> <span class="id" title="var">next_state</span>.(<span class="id" title="var">fees</span>).(<span class="id" title="var">fees_storage_xtz</span>) <span class="id" title="var">ctx</span>.(<span class="id" title="var">ctx_from</span>) = <span class="id" title="var">amount</span>-<span class="id" title="var">n</span> /\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">if</span> <span class="id" title="var">amount</span> =? 0 <span class="id" title="keyword">then</span> <span class="id" title="var">ops</span> = [] <span class="id" title="keyword">else</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">ops</span> = [<span class="id" title="var">act_transfer</span> <span class="id" title="var">ctx</span>.(<span class="id" title="var">ctx_from</span>) (<span class="id" title="var">N_to_amount</span> <span class="id" title="var">n</span>)]).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span> <span class="id" title="var">minter_receive</span> <span class="id" title="var">minter_init</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">destruct</span> (<span class="id" title="var">xtz_balance</span> (<span class="id" title="var">fees_storage_xtz</span> (<span class="id" title="var">fees</span> <span class="id" title="var">prev_state</span>)) (<span class="id" title="var">ctx_from</span> <span class="id" title="var">ctx</span>)) <span class="id" title="var">eqn</span>:<span class="id" title="var">E</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">E</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H2</span>. <span class="id" title="tactic">destruct</span> (<span class="id" title="var">throwIf</span> (<span class="id" title="var">address_is_contract</span> (<span class="id" title="var">ctx_from</span> <span class="id" title="var">ctx</span>))); <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>. <span class="id" title="tactic">inversion</span> <span class="id" title="var">H2</span>. <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">xtz_balance</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">n0</span> <span class="id" title="var">eqn</span>:<span class="id" title="var">E2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">FMap.find_add</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;* <span class="id" title="tactic">destruct</span> (<span class="id" title="var">Pos.sub_mask</span> <span class="id" title="var">p0</span> <span class="id" title="var">p1</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">FMap.find_remove</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">FMap.find_add</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;-- <span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">FMap.find_remove</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">destruct</span> (<span class="id" title="var">xtz_balance</span> (<span class="id" title="var">fees_storage_xtz</span> (<span class="id" title="var">fees</span> <span class="id" title="var">prev_state</span>)) (<span class="id" title="var">ctx_from</span> <span class="id" title="var">ctx</span>) =? 0) <span class="id" title="var">eqn</span>:<span class="id" title="var">E</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H2</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="tactic">destruct</span> (<span class="id" title="var">throwIf</span> (<span class="id" title="var">address_is_contract</span> (<span class="id" title="var">ctx_from</span> <span class="id" title="var">ctx</span>))); <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H2</span>; <span class="id" title="var">now</span> <span class="id" title="tactic">rewrite</span> <span class="id" title="var">E</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab185"></a><h1 class="section">Unwrap proofs</h1>
 The definition of functionality can be found in the Unwrap.v file
<div class="paragraph"> </div>

<a name="lab186"></a><h2 class="section">Unwrap ERC20 correct</h2>

</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">unwrap_erc20_functionally_correct</span> {<span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">prev_state</span> <span class="id" title="var">next_state</span> <span class="id" title="var">eth_address</span> <span class="id" title="var">amount</span> <span class="id" title="var">fees_amount</span> <span class="id" title="var">erc20_dest</span> <span class="id" title="var">acts</span> <span class="id" title="var">token_address</span> <span class="id" title="var">v</span> <span class="id" title="var">new_v</span>} :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">minter_receive</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">prev_state</span> (<span class="id" title="var">Some</span> (<span class="id" title="var">Unwrap</span> (<span class="id" title="var">unwrap_erc20_entrypoint</span> ({|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">erc_20</span> := <span class="id" title="var">eth_address</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">up_amount</span> := <span class="id" title="var">amount</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">up_fees</span> := <span class="id" title="var">fees_amount</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">up_erc20_destination</span> := <span class="id" title="var">erc20_dest</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;|})))) = <span class="id" title="var">Some</span> (<span class="id" title="var">next_state</span>, <span class="id" title="var">acts</span>)) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">get_fa2_token_id</span> <span class="id" title="var">eth_address</span> <span class="id" title="var">prev_state</span>.(<span class="id" title="var">assets</span>).(<span class="id" title="var">erc20tokens</span>) = <span class="id" title="var">Some</span> <span class="id" title="var">token_address</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;((<span class="id" title="var">FMap.find</span> (<span class="id" title="var">ctx</span>.(<span class="id" title="var">ctx_contract_address</span>), <span class="id" title="var">token_address</span>) (<span class="id" title="var">prev_state</span>.(<span class="id" title="var">fees</span>).(<span class="id" title="var">fees_storage_tokens</span>)) = <span class="id" title="var">Some</span> <span class="id" title="var">v</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">FMap.find</span> (<span class="id" title="var">ctx</span>.(<span class="id" title="var">ctx_contract_address</span>), <span class="id" title="var">token_address</span>) (<span class="id" title="var">next_state</span>.(<span class="id" title="var">fees</span>).(<span class="id" title="var">fees_storage_tokens</span>)) = <span class="id" title="var">Some</span> <span class="id" title="var">new_v</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">new_v</span> = <span class="id" title="var">fees_amount</span> + <span class="id" title="var">v</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">let</span> <span class="id" title="var">burnTokensParams</span> := {|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">mint_burn_owner</span>:= <span class="id" title="var">ctx</span>.(<span class="id" title="var">ctx_from</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">mint_burn_token_id</span> := <span class="id" title="var">snd</span> <span class="id" title="var">token_address</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">mint_burn_amount</span> := <span class="id" title="var">amount</span> + <span class="id" title="var">fees_amount</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;|} <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">mintTokensParams</span> :=  {|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">mint_burn_owner</span> := <span class="id" title="var">ctx</span>.(<span class="id" title="var">ctx_contract_address</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">mint_burn_token_id</span> := <span class="id" title="var">snd</span> <span class="id" title="var">token_address</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">mint_burn_amount</span> := <span class="id" title="var">fees_amount</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;|} <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">burn</span> := <span class="id" title="var">act_call</span> (<span class="id" title="var">fst</span> <span class="id" title="var">token_address</span>) 0 (<span class="id" title="var">serialize</span> (<span class="id" title="var">BurnTokens</span> [<span class="id" title="var">burnTokensParams</span>])) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> <span class="id" title="var">fees_amount</span> =? 0<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">then</span> <span class="id" title="var">acts</span> = [<span class="id" title="var">burn</span>]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span> <span class="id" title="var">acts</span> = [<span class="id" title="var">burn</span>] ++ [<span class="id" title="var">act_call</span> (<span class="id" title="var">fst</span> <span class="id" title="var">token_address</span>) 0 (<span class="id" title="var">serialize</span> (<span class="id" title="var">MintTokens</span> [<span class="id" title="var">mintTokensParams</span>]))])).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span> <span class="id" title="var">minter_receive</span> <span class="id" title="var">minter_init</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">unwrap_erc20</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>. <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">H0</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>; <span class="id" title="tactic">intros</span>; <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">unfold</span> <span class="id" title="var">Fees_Lib.token_balance</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H3</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">token_address</span>) <span class="id" title="var">eqn</span>:<span class="id" title="var">E2</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">Fees_Lib.check_fees_high_enough</span> <span class="id" title="var">fees_amount</span> (<span class="id" title="var">Fees_Lib.bps_of</span> <span class="id" title="var">amount</span> (<span class="id" title="var">erc20_unwrapping_fees</span> (<span class="id" title="var">governance</span> <span class="id" title="var">prev_state</span>)))) <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">H6</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H4</span>. <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H4</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">E2</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H4</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">FMap.find_add</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H4</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">destruct</span> (<span class="id" title="var">token_address</span>) <span class="id" title="var">eqn</span>:<span class="id" title="var">E2</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">Fees_Lib.check_fees_high_enough</span> <span class="id" title="var">fees_amount</span> (<span class="id" title="var">Fees_Lib.bps_of</span> <span class="id" title="var">amount</span> (<span class="id" title="var">erc20_unwrapping_fees</span> (<span class="id" title="var">governance</span> <span class="id" title="var">prev_state</span>)))) <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">fees_amount</span> <span class="id" title="var">eqn</span>:<span class="id" title="var">E3</span>; <span class="id" title="var">cbn</span> <span class="id" title="tactic">in</span> *; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">rewrite</span> <span class="id" title="var">E2</span>; <span class="id" title="var">easy</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab187"></a><h2 class="section">Unwrap ERC721 correct</h2>

</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">unwrap_erc721_functionally_correct</span> {<span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">prev_state</span> <span class="id" title="var">next_state</span> <span class="id" title="var">eth_address</span> <span class="id" title="var">erc721_dest</span> <span class="id" title="var">acts</span> <span class="id" title="var">token_id</span> <span class="id" title="var">token_addr</span> <span class="id" title="var">v</span> <span class="id" title="var">new_v</span>} :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">minter_receive</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">prev_state</span> (<span class="id" title="var">Some</span> (<span class="id" title="var">Unwrap</span> (<span class="id" title="var">unwrap_erc721_entrypoint</span> ({|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">erc_721</span> := <span class="id" title="var">eth_address</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">up_token_id</span> := <span class="id" title="var">token_id</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">up_erc721_destination</span> := <span class="id" title="var">erc721_dest</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;|})))) = <span class="id" title="var">Some</span> (<span class="id" title="var">next_state</span>, <span class="id" title="var">acts</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">get_nft_contract</span> <span class="id" title="var">eth_address</span> <span class="id" title="var">prev_state</span>.(<span class="id" title="var">assets</span>).(<span class="id" title="var">erc721tokens</span>) = <span class="id" title="var">Some</span> <span class="id" title="var">token_addr</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;((<span class="id" title="var">FMap.find</span> <span class="id" title="var">ctx</span>.(<span class="id" title="var">ctx_contract_address</span>) (<span class="id" title="var">prev_state</span>.(<span class="id" title="var">fees</span>).(<span class="id" title="var">fees_storage_xtz</span>)) = <span class="id" title="var">Some</span> <span class="id" title="var">v</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">FMap.find</span> <span class="id" title="var">ctx</span>.(<span class="id" title="var">ctx_contract_address</span>) (<span class="id" title="var">next_state</span>.(<span class="id" title="var">fees</span>).(<span class="id" title="var">fees_storage_xtz</span>)) = <span class="id" title="var">Some</span> <span class="id" title="var">new_v</span> -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">new_v</span> = <span class="id" title="var">v</span> + (<span class="id" title="var">Z.to_N</span> (<span class="id" title="var">ctx</span>.(<span class="id" title="var">ctx_amount</span>))))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;/\<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">burnTokensParams</span> := {|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">mint_burn_owner</span> := <span class="id" title="var">ctx</span>.(<span class="id" title="var">ctx_from</span>);<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">mint_burn_token_id</span> := <span class="id" title="var">token_id</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">mint_burn_amount</span> := 1<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;|} <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">burn</span> := <span class="id" title="var">act_call</span> <span class="id" title="var">token_addr</span> 0 (<span class="id" title="var">serialize</span> (<span class="id" title="var">BurnTokens</span> [<span class="id" title="var">burnTokensParams</span>])) <span class="id" title="tactic">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">acts</span> = [<span class="id" title="var">burn</span>]<br/>
&nbsp;&nbsp;&nbsp;&nbsp;).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span> <span class="id" title="var">minter_receive</span> <span class="id" title="var">minter_init</span>. <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">setoid_rewrite</span> <span class="id" title="var">FMap.find_add</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">split</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H4</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">inversion</span> <span class="id" title="var">H4</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">easy</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab188"></a><h2 class="section">Unwrap Safety Properties</h2>
<a name="lab189"></a><h2 class="section">Unwrap ERC20 fails if fees are below min</h2>

</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">unwrap_erc20_fees_below_min</span> {<span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">prev_state</span> <span class="id" title="var">eth_address</span> <span class="id" title="var">amount</span> <span class="id" title="var">fees_amount</span> <span class="id" title="var">erc20_dest</span>} :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">fees_amount</span> &lt; <span class="id" title="var">Fees_Lib.bps_of</span> <span class="id" title="var">amount</span> <span class="id" title="var">prev_state</span>.(<span class="id" title="var">governance</span>).(<span class="id" title="var">erc20_unwrapping_fees</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">minter_receive</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">prev_state</span> (<span class="id" title="var">Some</span> (<span class="id" title="var">Unwrap</span> (<span class="id" title="var">unwrap_erc20_entrypoint</span> ({|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">erc_20</span> := <span class="id" title="var">eth_address</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">up_amount</span> := <span class="id" title="var">amount</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">up_fees</span> := <span class="id" title="var">fees_amount</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">up_erc20_destination</span> := <span class="id" title="var">erc20_dest</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;|})))) = <span class="id" title="var">None</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span> <span class="id" title="var">minter_receive</span> <span class="id" title="var">minter_init</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">fail_if_paused</span> (<span class="id" title="var">admin</span> <span class="id" title="var">prev_state</span>)); <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">fail_if_amount</span> <span class="id" title="var">ctx</span>); <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">unwrap_erc20</span>. <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">get_fa2_token_id</span> <span class="id" title="var">eth_address</span> (<span class="id" title="var">erc20tokens</span> (<span class="id" title="var">assets</span> <span class="id" title="var">prev_state</span>))); <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">t</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">Fees_Lib.check_fees_high_enough</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">throwIf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">N.ltb_lt</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab190"></a><h2 class="section">Unwrap ERC721 fails if fees are below min</h2>

</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">unwrap_erc721_fees_below_min</span> {<span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">prev_state</span> <span class="id" title="var">eth_address</span> <span class="id" title="var">erc721_dest</span> <span class="id" title="var">token_id</span>} :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Z.to_N</span> <span class="id" title="var">ctx</span>.(<span class="id" title="var">ctx_amount</span>) &lt; <span class="id" title="var">prev_state</span>.(<span class="id" title="var">governance</span>).(<span class="id" title="var">erc721_unwrapping_fees</span>) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">minter_receive</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">prev_state</span> (<span class="id" title="var">Some</span> (<span class="id" title="var">Unwrap</span> (<span class="id" title="var">unwrap_erc721_entrypoint</span> ({|<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">erc_721</span> := <span class="id" title="var">eth_address</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">up_token_id</span> := <span class="id" title="var">token_id</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">up_erc721_destination</span> := <span class="id" title="var">erc721_dest</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;|})))) = <span class="id" title="var">None</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span> <span class="id" title="var">minter_receive</span> <span class="id" title="var">minter_init</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">fail_if_paused</span> (<span class="id" title="var">admin</span> <span class="id" title="var">prev_state</span>)); <span class="id" title="tactic">try</span> <span class="id" title="var">easy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">Fees_Lib.check_nft_fees_high_enough</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <span class="id" title="var">throwIf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> &lt;- <span class="id" title="var">N.ltb_lt</span> <span class="id" title="tactic">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab191"></a><h1 class="section">SignerOps Proofs</h1>
 The definition of functionality can be found in the SignerOps.v and SignerOps_Interface.v files
<div class="paragraph"> </div>

<a name="lab192"></a><h2 class="section">Signer Ops Correct</h2>

</div>
<div class="code">
<span class="id" title="keyword">Lemma</span> <span class="id" title="var">signer_ops_functionally_correct</span> {<span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">prev_state</span> <span class="id" title="var">next_state</span> <span class="id" title="var">signer</span> <span class="id" title="var">addr</span>} :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">minter_receive</span> <span class="id" title="var">chain</span> <span class="id" title="var">ctx</span> <span class="id" title="var">prev_state</span> (<span class="id" title="var">Some</span> (<span class="id" title="var">Signer_Ops</span> (<span class="id" title="var">set_payment_address</span> {| <span class="id" title="var">sparam_signer</span>:= <span class="id" title="var">signer</span>; <span class="id" title="var">payment_address</span>:=<span class="id" title="var">addr</span> |}))) = <span class="id" title="var">Some</span>(<span class="id" title="var">next_state</span>, []) -&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">FMap.find</span> <span class="id" title="var">signer</span> <span class="id" title="var">next_state</span>.(<span class="id" title="var">fees</span>).(<span class="id" title="var">fees_storage_signers</span>) = <span class="id" title="var">Some</span> <span class="id" title="var">addr</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">contract_simpl</span> <span class="id" title="var">minter_receive</span> <span class="id" title="var">minter_init</span>. <span class="id" title="var">cbn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">FMap.find_add</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>

<br/>
<span class="id" title="keyword">End</span> <span class="id" title="var">Main</span>.<br/>
</div>
</div>

<div id="footer">
<hr/><a href="index.html">Index</a><hr/>This page has been generated by <a href="http://coq.inria.fr/">coqdoc</a>
</div>

</div>

</body>
</html>