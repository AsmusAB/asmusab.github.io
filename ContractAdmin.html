<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<link href="coqdoc.css" rel="stylesheet" type="text/css" />
<title>ContractAdmin</title>
</head>

<body>

<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">Library ContractAdmin</h1>

<div class="code">
</div>

<div class="doc">
<a name="lab116"></a><h1 class="section">Contract admin part of the Minter Contract</h1>
 This file contains the implementation of the Contract Admin part of the Minter Contract
    The contracts handles all incoming calls that manages admin functionality for the contract. Such as for example changing the new oracle, signer MinterAdmin and also a pause for the whole contract.
    The file this file has been translated from can be found here:
    https://github.com/bender-labs/wrap-tz-contracts/blob/1655949e61b05a1c25cc00dcb8c1da9d91799f31/ligo/minter/contract_admin.mligo

</div>
<div class="code">

<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">Storage</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">Blockchain</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">List</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">Automation</span>.<br/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">Serializable</span>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">ConCert.Execution</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">Monads</span>.<br/>
<span class="id" title="keyword">Import</span> <span class="id" title="var">ListNotations</span>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">ConCert.Utils</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <span class="id" title="var">RecordUpdate</span>.<br/>

<br/>
<span class="id" title="keyword">Section</span> <span class="id" title="var">ContractAdmin</span>.<br/>
<span class="id" title="keyword">Context</span> {<span class="id" title="var">BaseTypes</span> : <span class="id" title="var">ChainBase</span>}.<br/>

<br/>
</div>

<div class="doc">
<a name="lab117"></a><h2 class="section">The Entrypoints of the Contract Admin</h2>

</div>
<div class="code">
<span class="id" title="keyword">Inductive</span> <span class="id" title="var">ContractAdminEntrypoints</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">SetAdministrator</span> (<span class="id" title="var">addr</span> : <span class="id" title="var">Address</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">ConfirmMinterAdmin</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">SetOracle</span> (<span class="id" title="var">addr</span> : <span class="id" title="var">Address</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">SetSigner</span> (<span class="id" title="var">addr</span> : <span class="id" title="var">Address</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">PauseContract</span> (<span class="id" title="var">pause</span> : <span class="id" title="var">bool</span>).<br/>

<br/>

<br/>
</div>

<div class="doc">
<a name="lab118"></a><h2 class="section">The Return type of all the Contract Admin Entrypoints</h2>

</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <span class="id" title="var">ContractAdminReturnType</span> : <span class="id" title="keyword">Type</span> := (<span class="id" title="var">list</span> <span class="id" title="var">ActionBody</span> * <span class="id" title="var">ContractAdminStorage</span>).<br/>

<br/>
</div>

<div class="doc">
<a name="lab119"></a><h2 class="section">All the fail criteria for the entrypoints</h2>
 Fail if the caller is not admin 
</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <span class="id" title="var">fail_if_not_admin</span> (<span class="id" title="var">ctx</span> : <span class="id" title="var">ContractCallContext</span>) (<span class="id" title="var">s</span> : <span class="id" title="var">ContractAdminStorage</span>) : <span class="id" title="var">option</span> <span class="id" title="var">unit</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> <span class="id" title="var">address_eqb</span> <span class="id" title="var">s</span>.(<span class="id" title="var">administrator</span>) <span class="id" title="var">ctx</span>.(<span class="id" title="var">ctx_from</span>) <span class="id" title="keyword">then</span> <span class="id" title="var">Some</span> <span class="id" title="var">tt</span> <span class="id" title="keyword">else</span> <span class="id" title="var">None</span>.<br/>

<br/>
</div>

<div class="doc">
Fail if the caller is not a signer 
</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <span class="id" title="var">fail_if_not_signer</span> (<span class="id" title="var">ctx</span> : <span class="id" title="var">ContractCallContext</span>) (<span class="id" title="var">s</span> : <span class="id" title="var">ContractAdminStorage</span>) : <span class="id" title="var">option</span> <span class="id" title="var">unit</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> <span class="id" title="var">address_eqb</span> <span class="id" title="var">s</span>.(<span class="id" title="var">signer</span>) <span class="id" title="var">ctx</span>.(<span class="id" title="var">ctx_from</span>) <span class="id" title="keyword">then</span> <span class="id" title="var">Some</span> <span class="id" title="var">tt</span> <span class="id" title="keyword">else</span> <span class="id" title="var">None</span>.<br/>

<br/>
</div>

<div class="doc">
Fail if the caller is not the oracle 
</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <span class="id" title="var">fail_if_not_oracle</span> (<span class="id" title="var">ctx</span> : <span class="id" title="var">ContractCallContext</span>) (<span class="id" title="var">s</span> : <span class="id" title="var">ContractAdminStorage</span>) : <span class="id" title="var">option</span> <span class="id" title="var">unit</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> <span class="id" title="var">address_eqb</span> <span class="id" title="var">s</span>.(<span class="id" title="var">oracle</span>) <span class="id" title="var">ctx</span>.(<span class="id" title="var">ctx_from</span>) <span class="id" title="keyword">then</span> <span class="id" title="var">Some</span> <span class="id" title="var">tt</span> <span class="id" title="keyword">else</span> <span class="id" title="var">None</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab120"></a><h2 class="section">Sets a new administrator</h2>

</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <span class="id" title="var">set_administrator</span> (<span class="id" title="var">s</span> : <span class="id" title="var">ContractAdminStorage</span>) (<span class="id" title="var">new_administrator</span> : <span class="id" title="var">Address</span>) : <span class="id" title="var">ContractAdminReturnType</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;([],<span class="id" title="var">s</span>&lt;|<span class="id" title="var">administrator</span> := <span class="id" title="var">new_administrator</span>|&gt;).<br/>

<br/>
</div>

<div class="doc">
<a name="lab121"></a><h2 class="section">Sets a new signer</h2>

</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <span class="id" title="var">set_signer</span> (<span class="id" title="var">s</span> : <span class="id" title="var">ContractAdminStorage</span>) (<span class="id" title="var">new_signer</span> : <span class="id" title="var">Address</span>) : <span class="id" title="var">ContractAdminReturnType</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;([],<span class="id" title="var">s</span>&lt;|<span class="id" title="var">signer</span>:=<span class="id" title="var">new_signer</span>|&gt;).<br/>

<br/>
</div>

<div class="doc">
<a name="lab122"></a><h2 class="section">Pause or unpause contract</h2>

</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <span class="id" title="var">pause</span> (<span class="id" title="var">s</span> : <span class="id" title="var">ContractAdminStorage</span>) (<span class="id" title="var">p</span> : <span class="id" title="var">bool</span>) : <span class="id" title="var">ContractAdminReturnType</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;([],<span class="id" title="var">s</span>&lt;|<span class="id" title="var">paused</span>:=<span class="id" title="var">p</span>|&gt;).<br/>

<br/>
</div>

<div class="doc">
<a name="lab123"></a><h2 class="section">Confirms a new admin</h2>

</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <span class="id" title="var">confirm_new_minter_admin</span> (<span class="id" title="var">ctx</span> : <span class="id" title="var">ContractCallContext</span>) (<span class="id" title="var">s</span> : <span class="id" title="var">ContractAdminStorage</span>) : <span class="id" title="var">option</span> <span class="id" title="var">ContractAdminReturnType</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">s</span>.(<span class="id" title="var">pending_admin</span>) <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">Some</span> <span class="id" title="var">pending_admin_curr</span> =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> <span class="id" title="var">address_eqb</span> <span class="id" title="var">pending_admin_curr</span> <span class="id" title="var">ctx</span>.(<span class="id" title="var">ctx_from</span>) <span class="id" title="keyword">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Some</span> ([], <span class="id" title="var">s</span>&lt;|<span class="id" title="var">pending_admin</span>:=<span class="id" title="var">None</span>|&gt;&lt;|<span class="id" title="var">administrator</span>:=<span class="id" title="var">ctx</span>.(<span class="id" title="var">ctx_from</span>)|&gt;)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span> <span class="id" title="var">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">None</span> =&gt; <span class="id" title="var">None</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab124"></a><h2 class="section">The main entrypoint function</h2>

</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <span class="id" title="var">contract_admin_main</span> (<span class="id" title="var">ctx</span>: <span class="id" title="var">ContractCallContext</span>) (<span class="id" title="var">p</span> : <span class="id" title="var">ContractAdminEntrypoints</span>) (<span class="id" title="var">s</span> : <span class="id" title="var">ContractAdminStorage</span>) : <span class="id" title="var">option</span> <span class="id" title="var">ContractAdminReturnType</span> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">p</span> <span class="id" title="keyword">with</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">SetAdministrator</span> <span class="id" title="var">n</span> =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">do</span> <span class="id" title="var">_</span> &lt;- <span class="id" title="var">fail_if_not_admin</span> <span class="id" title="var">ctx</span> <span class="id" title="var">s</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Some</span> (<span class="id" title="var">set_administrator</span> <span class="id" title="var">s</span> <span class="id" title="var">n</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">SetOracle</span> <span class="id" title="var">n</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">do</span> <span class="id" title="var">_</span>  &lt;- <span class="id" title="var">fail_if_not_admin</span> <span class="id" title="var">ctx</span> <span class="id" title="var">s</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Some</span> ([], <span class="id" title="var">s</span>&lt;|<span class="id" title="var">oracle</span> := <span class="id" title="var">n</span>|&gt;)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">SetSigner</span> <span class="id" title="var">n</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">do</span> <span class="id" title="var">_</span> &lt;- <span class="id" title="var">fail_if_not_admin</span> <span class="id" title="var">ctx</span> <span class="id" title="var">s</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Some</span> (<span class="id" title="var">set_signer</span> <span class="id" title="var">s</span> <span class="id" title="var">n</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">ConfirmMinterAdmin</span> =&gt; <span class="id" title="var">confirm_new_minter_admin</span> <span class="id" title="var">ctx</span> <span class="id" title="var">s</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">PauseContract</span> <span class="id" title="var">p</span> =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">do</span> <span class="id" title="var">_</span> &lt;- <span class="id" title="var">fail_if_not_admin</span> <span class="id" title="var">ctx</span> <span class="id" title="var">s</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">Some</span> (<span class="id" title="var">pause</span> <span class="id" title="var">s</span> <span class="id" title="var">p</span> )<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>

<br/>
<span class="id" title="keyword">End</span> <span class="id" title="var">ContractAdmin</span>.<br/>
</div>
</div>

<div id="footer">
<hr/><a href="index.html">Index</a><hr/>This page has been generated by <a href="http://coq.inria.fr/">coqdoc</a>
</div>

</div>

</body>
</html>